<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Ø¬ÙˆØ§Ù‡Ø±ÛŒ Ø³ØªØ§Ø±Ø²Ø§Ø¯Ù‡ - Ø·Ù„Ø§ Ùˆ Ø¬ÙˆØ§Ù‡Ø±Ø§Øª</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBFw0Qbyq9zTFTd-tUY6d_s6U4UYZu5g9E&libraries=places&language=fa" async defer></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --gold-primary: #D4AF37;
            --gold-secondary: #C9A961;
            --gold-dark: #B8860B;
            --gold-light: #F4E4BC;
            --black-primary: #1a1a1a;
            --black-secondary: #2c2c2c;
            --cream-bg: #FAF8F3;
            --cream-light: #F5F1E8;
            --white: #FFFFFF;
            --gray-light: #E8E5DF;
            --gray-medium: #9B9B9B;
            --gray-dark: #5A5A5A;
            --shadow-sm: 0 2px 8px rgba(26, 26, 26, 0.08);
            --shadow-md: 0 4px 16px rgba(26, 26, 26, 0.12);
            --shadow-lg: 0 8px 32px rgba(26, 26, 26, 0.16);
            --shadow-gold: 0 4px 20px rgba(212, 175, 55, 0.25);
        }

        body {
            font-family: 'Vazirmatn', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--cream-bg) 0%, var(--cream-light) 100%);
            direction: rtl;
            overflow-x: hidden;
            padding-bottom: 80px;
            padding-top: 80px;
            color: var(--black-primary);
            line-height: 1.6;
        }

        /* Header Styles */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, var(--white) 0%, var(--cream-light) 100%);
            box-shadow: var(--shadow-md);
            border-bottom: 2px solid var(--gold-light);
            z-index: 1000;
            padding: 16px 20px;
            backdrop-filter: blur(10px);
        }

        .header-content {
            display: flex;
            align-items: center;
            gap: 12px;
            justify-content: space-between;
        }

        .header-admin-mode .store-selector,
        .header-admin-mode .address-btn,
        .header-admin-mode .menu-btn {
            display: none;
        }

        .header-admin-buttons {
            display: none;
            gap: 12px;
            flex: 1;
        }

        .header-admin-mode .header-admin-buttons {
            display: flex;
        }

        .header-admin-mode .back-btn {
            display: flex !important;
        }

        .header-admin-btn {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 14px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            min-height: 52px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-sm);
            letter-spacing: 0.3px;
        }

        .header-admin-btn:active {
            transform: scale(0.98);
        }

        .header-admin-btn-support {
            background: linear-gradient(135deg, var(--black-primary) 0%, var(--black-secondary) 100%);
            color: var(--gold-primary);
            border: 2px solid var(--gold-primary);
        }

        .header-admin-btn-support:hover {
            background: linear-gradient(135deg, var(--gold-primary) 0%, var(--gold-secondary) 100%);
            color: var(--black-primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-gold);
        }

        .header-admin-btn-products {
            background: linear-gradient(135deg, var(--black-primary) 0%, var(--black-secondary) 100%);
            color: var(--gold-primary);
            border: 2px solid var(--gold-primary);
        }

        .header-admin-btn-products:hover {
            background: linear-gradient(135deg, var(--gold-primary) 0%, var(--gold-secondary) 100%);
            color: var(--black-primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-gold);
        }

        .store-selector {
            flex: 1;
            position: relative;
        }

        .store-selector-btn {
            width: 100%;
            padding: 12px 18px;
            background: linear-gradient(135deg, var(--gold-primary) 0%, var(--gold-secondary) 100%);
            color: var(--black-primary);
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            text-align: right;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-gold);
            letter-spacing: 0.3px;
        }

        .store-selector-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(212, 175, 55, 0.35);
            background: linear-gradient(135deg, var(--gold-secondary) 0%, var(--gold-primary) 100%);
        }

        .store-selector-btn:active {
            transform: translateY(0);
        }

        .store-selector-btn::after {
            content: 'â–¼';
            font-size: 10px;
            margin-right: 8px;
        }

        .store-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            left: 0;
            background: var(--white);
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--gold-light);
            margin-top: 8px;
            display: none;
            z-index: 1001;
            max-height: 200px;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .store-dropdown.show {
            display: block;
        }

        .store-option {
            padding: 14px 18px;
            cursor: pointer;
            border-bottom: 1px solid var(--gray-light);
            transition: all 0.2s ease;
            font-weight: 500;
            color: var(--black-primary);
        }

        .store-option:last-child {
            border-bottom: none;
        }

        .store-option:hover {
            background: linear-gradient(90deg, var(--gold-light) 0%, transparent 100%);
            padding-right: 22px;
        }

        .address-btn {
            padding: 12px 24px;
            background: var(--black-primary);
            color: var(--white);
            border: 2px solid var(--gold-primary);
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
            letter-spacing: 0.3px;
        }

        .address-btn:hover {
            background: var(--gold-primary);
            color: var(--black-primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-gold);
        }

        .menu-btn {
            padding: 12px 18px;
            background: var(--black-primary);
            color: var(--gold-primary);
            border: 2px solid var(--gold-primary);
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: var(--shadow-sm);
        }

        .menu-btn:hover {
            background: var(--gold-primary);
            color: var(--black-primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-gold);
        }

        .menu-btn::before {
            content: 'â˜°';
            font-size: 18px;
        }

        .back-btn {
            padding: 10px 16px;
            background: var(--black-primary);
            color: var(--gold-primary);
            border: 2px solid var(--gold-primary);
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
            box-shadow: var(--shadow-sm);
        }

        .back-btn:hover {
            background: var(--gold-primary);
            color: var(--black-primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-gold);
        }

        .back-btn::before {
            content: 'â†';
            font-size: 20px;
        }

        .accordion-menu {
            position: fixed;
            top: 70px;
            left: 20px;
            background: var(--white);
            border-radius: 16px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--gold-light);
            display: none;
            z-index: 1002;
            min-width: 220px;
            overflow: hidden;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .accordion-menu.show {
            display: block;
        }

        .accordion-item {
            border-bottom: 1px solid var(--gray-light);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .accordion-item:last-child {
            border-bottom: none;
        }

        .accordion-item:hover {
            background: linear-gradient(90deg, var(--gold-light) 0%, transparent 100%);
        }

        .accordion-item-content {
            padding: 16px 20px;
            font-size: 15px;
            color: var(--black-primary);
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .accordion-item-content::after {
            content: 'â€º';
            font-size: 20px;
            color: var(--gold-primary);
            font-weight: bold;
        }

        /* Content Area */
        .content-area {
            padding: 24px 20px;
            min-height: calc(100vh - 160px);
        }

        .search-results {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .chat-thread {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .message {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 16px;
            font-size: 14px;
            line-height: 1.6;
            position: relative;
            word-break: break-word;
        }

        .message-user {
            align-self: flex-end;
            background: linear-gradient(135deg, var(--gold-primary) 0%, var(--gold-secondary) 100%);
            color: var(--black-primary);
            border-bottom-right-radius: 4px;
            box-shadow: var(--shadow-sm);
            font-weight: 500;
        }

        .message-bot {
            align-self: flex-start;
            background: var(--white);
            color: var(--black-primary);
            border-bottom-left-radius: 4px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--gray-light);
        }

        .message-text {
            white-space: pre-wrap;
        }

        .message-media {
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .message-media img {
            width: 100%;
            border-radius: 12px;
            object-fit: cover;
        }

        .message-media figcaption {
            font-size: 13px;
            color: #333;
            padding: 8px 0 0 0;
            line-height: 1.5;
            text-align: right;
        }

        .message-location {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .message-location a {
            color: #0088cc;
            text-decoration: none;
            font-weight: 600;
        }

        .message-location a:hover {
            text-decoration: underline;
        }

        .location-coords {
            font-size: 12px;
            color: #666;
        }

        .message-status {
            font-size: 12px;
            color: #999;
            margin-top: 4px;
            text-align: left;
        }

        .typing-dots::after {
            content: 'â€¦';
            animation: blink 1.2s infinite;
        }

        @keyframes blink {
            0% { opacity: 0.2; }
            50% { opacity: 1; }
            100% { opacity: 0.2; }
        }

        .result-item {
            background: var(--white);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--gold-light);
            animation: fadeIn 0.4s ease-in;
            transition: all 0.3s ease;
        }

        .result-item:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-image {
            width: 100%;
            height: 200px;
            background-color: #4caf50;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
        }

        .result-text {
            padding: 12px 16px;
            font-size: 14px;
            color: #333;
            line-height: 1.6;
        }

        .result-text-only {
            padding: 16px;
            font-size: 14px;
            color: #333;
            line-height: 1.6;
        }

        /* Search Bar */
        .search-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, var(--white) 0%, var(--cream-light) 100%);
            box-shadow: 0 -4px 20px rgba(26, 26, 26, 0.1);
            border-top: 2px solid var(--gold-light);
            padding: 16px 20px;
            z-index: 1000;
            display: flex;
            gap: 12px;
            align-items: center;
            backdrop-filter: blur(10px);
        }

        .search-input {
            flex: 1;
            padding: 14px 20px;
            border: 2px solid var(--gray-light);
            border-radius: 30px;
            font-size: 15px;
            direction: rtl;
            outline: none;
            transition: all 0.3s ease;
            background: var(--white);
            font-weight: 500;
        }

        .search-input:focus {
            border-color: var(--gold-primary);
            box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.1);
        }

        .search-btn {
            width: 52px;
            height: 52px;
            background: linear-gradient(135deg, var(--gold-primary) 0%, var(--gold-secondary) 100%);
            color: var(--black-primary);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: bold;
            transition: all 0.3s ease;
            flex-shrink: 0;
            box-shadow: var(--shadow-gold);
        }

        .search-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 24px rgba(212, 175, 55, 0.35);
        }

        .search-btn:active {
            transform: scale(0.95);
        }

        .search-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(26, 26, 26, 0.7);
            backdrop-filter: blur(4px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, var(--white) 0%, var(--cream-light) 100%);
            border-radius: 24px;
            padding: 32px;
            max-width: 420px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideUp 0.4s ease-out;
            box-shadow: var(--shadow-lg);
            border: 2px solid var(--gold-light);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 24px;
            color: var(--black-primary);
            text-align: center;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--gold-light);
            letter-spacing: 0.5px;
        }

        .modal-body {
            margin-bottom: 20px;
            color: #666;
            line-height: 1.6;
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .modal-btn-primary {
            background: linear-gradient(135deg, var(--gold-primary) 0%, var(--gold-secondary) 100%);
            color: var(--black-primary);
            font-weight: 600;
            box-shadow: var(--shadow-gold);
            transition: all 0.3s ease;
        }

        .modal-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(212, 175, 55, 0.35);
        }

        .modal-btn-secondary {
            background: var(--gray-light);
            color: var(--black-primary);
            font-weight: 500;
            border: 1px solid var(--gray-medium);
            transition: all 0.3s ease;
        }

        .modal-btn-secondary:hover {
            background: var(--gray-medium);
            color: var(--white);
            transform: translateY(-2px);
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 6px;
            font-size: 14px;
            font-weight: 500;
            color: #333;
        }

        .form-input {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid var(--gray-light);
            border-radius: 12px;
            font-size: 15px;
            direction: rtl;
            outline: none;
            transition: all 0.3s ease;
            background: var(--white);
            font-weight: 500;
        }

        .form-input:focus {
            border-color: var(--gold-primary);
            box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.1);
        }

        .form-textarea {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid var(--gray-light);
            border-radius: 12px;
            font-size: 15px;
            direction: rtl;
            outline: none;
            resize: vertical;
            min-height: 120px;
            transition: all 0.3s ease;
            font-family: inherit;
            background: var(--white);
            font-weight: 500;
        }

        .form-textarea:focus {
            border-color: var(--gold-primary);
            box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.1);
        }

        .form-submit-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--gold-primary) 0%, var(--gold-secondary) 100%);
            color: var(--black-primary);
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-gold);
            letter-spacing: 0.5px;
            margin-top: 8px;
        }

        .form-submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(212, 175, 55, 0.35);
        }

        .form-submit-btn:active {
            transform: translateY(0);
        }

        .form-submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .gold-price-container {
            padding: 16px 0;
        }

        .gold-price-item {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
        }

        .gold-price-item:last-child {
            border-bottom: none;
        }

        .gold-price-label {
            font-weight: 500;
            color: #333;
        }

        .gold-price-value {
            color: var(--gold-primary);
            font-weight: 700;
            font-size: 16px;
        }

        /* Admin Dashboard */
        .admin-dashboard {
            display: none;
            padding: 16px;
            padding-bottom: 180px;
            min-height: calc(100vh - 160px);
            flex-direction: column;
            position: relative;
        }

        .admin-dashboard.show {
            display: flex;
        }

        .admin-buttons-top {
            display: none;
        }

        .admin-buttons-bottom {
            display: flex;
            flex-direction: column;
            gap: 12px;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 16px;
            background-color: #f5f5f5;
            z-index: 100;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);
        }

        .admin-buttons-row {
            display: flex;
            gap: 12px;
        }

        .admin-buttons-row .admin-btn {
            flex: 1;
        }

        .admin-btn {
            padding: 18px 24px;
            border: none;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            min-height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-md);
            letter-spacing: 0.3px;
        }

        .admin-btn:active {
            transform: translateY(0) scale(0.98);
        }

        .admin-btn-support {
            background: linear-gradient(135deg, var(--black-primary) 0%, var(--black-secondary) 100%);
            color: var(--gold-primary);
            border: 2px solid var(--gold-primary);
        }

        .admin-btn-support:hover {
            background: linear-gradient(135deg, var(--gold-primary) 0%, var(--gold-secondary) 100%);
            color: var(--black-primary);
            transform: translateY(-3px);
            box-shadow: var(--shadow-gold);
        }

        .admin-btn-products {
            background: linear-gradient(135deg, var(--black-primary) 0%, var(--black-secondary) 100%);
            color: var(--gold-primary);
            border: 2px solid var(--gold-primary);
        }

        .admin-btn-products:hover {
            background: linear-gradient(135deg, var(--gold-primary) 0%, var(--gold-secondary) 100%);
            color: var(--black-primary);
            transform: translateY(-3px);
            box-shadow: var(--shadow-gold);
        }

        .admin-btn-update {
            background: linear-gradient(135deg, var(--gold-primary) 0%, var(--gold-secondary) 100%);
            color: var(--black-primary);
            border: 2px solid var(--gold-dark);
        }

        .admin-btn-update:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-gold);
            background: linear-gradient(135deg, var(--gold-secondary) 0%, var(--gold-primary) 100%);
        }

        .admin-btn-delete {
            background: linear-gradient(135deg, #C41E3A 0%, #8B0000 100%);
            color: var(--white);
            border: 2px solid #8B0000;
        }

        .admin-btn-delete:hover {
            background: linear-gradient(135deg, #8B0000 0%, #C41E3A 100%);
            transform: translateY(-3px);
            box-shadow: 0 6px 24px rgba(196, 30, 58, 0.35);
        }

        .admin-btn-add {
            background: linear-gradient(135deg, var(--gold-primary) 0%, var(--gold-secondary) 100%);
            color: var(--black-primary);
            border: 2px solid var(--gold-dark);
        }

        .admin-btn-add:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-gold);
            background: linear-gradient(135deg, var(--gold-secondary) 0%, var(--gold-primary) 100%);
        }

        /* Admin Pages */
        .admin-page {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--cream-bg) 0%, var(--cream-light) 100%);
            z-index: 2000;
            padding: 80px 20px 20px 20px;
            overflow-y: auto;
        }

        .admin-page.show {
            display: block;
        }

        .admin-page-content {
            background: linear-gradient(135deg, var(--white) 0%, var(--cream-light) 100%);
            border: 2px solid var(--gold-primary);
            border-radius: 24px;
            padding: 32px;
            padding-left: 80px;
            max-width: 520px;
            margin: 0 auto;
            position: relative;
            box-shadow: var(--shadow-lg);
        }

        .admin-page-back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 48px;
            height: 48px;
            background: var(--black-primary);
            color: var(--gold-primary);
            border: 2px solid var(--gold-primary);
            border-radius: 12px;
            font-size: 24px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 10;
            box-shadow: var(--shadow-sm);
        }

        .admin-page-back-btn:hover {
            background: var(--gold-primary);
            color: var(--black-primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-gold);
        }

        .admin-page-back-btn:active {
            transform: scale(0.95);
        }

        #deleteEditPage .admin-page-content {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: calc(100vh - 160px);
            padding-bottom: 40px;
        }

        .delete-edit-bottom-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
        }

        .delete-edit-label {
            font-size: 14px;
            font-weight: 500;
            color: #333;
            margin-bottom: 4px;
        }

        .delete-edit-form {
            display: flex;
            flex-direction: row-reverse;
            gap: 8px;
            align-items: center;
            width: 100%;
        }

        .delete-edit-input {
            flex: 1;
            padding: 10px 16px;
            border: 2px solid #0088cc;
            border-radius: 24px;
            font-size: 14px;
            direction: rtl;
            outline: none;
            transition: border-color 0.2s;
            font-family: inherit;
            box-sizing: border-box;
        }

        .delete-edit-input:focus {
            border-color: #0077b3;
        }

        .delete-edit-send-btn {
            width: 44px;
            height: 44px;
            background-color: #0088cc;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 20px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s, transform 0.2s;
            flex-shrink: 0;
        }

        .delete-edit-send-btn:hover {
            background-color: #0077b3;
        }

        .delete-edit-send-btn:active {
            transform: scale(0.95);
        }

        .delete-edit-send-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .delete-edit-results {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 20px;
            max-height: calc(100vh - 300px);
            overflow-y: auto;
            padding: 16px 0;
        }

        .delete-edit-image-item {
            background-color: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .delete-edit-image-item:hover {
            border-color: #0088cc;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .delete-edit-image-item.selected {
            border-color: #0088cc;
            background-color: #f0f8ff;
            box-shadow: 0 0 0 3px rgba(0, 136, 204, 0.2);
        }

        .delete-edit-image-item img {
            width: 100%;
            border-radius: 8px;
            object-fit: cover;
            max-height: 300px;
            margin-bottom: 8px;
        }

        .delete-edit-image-caption {
            font-size: 14px;
            color: #333;
            text-align: right;
            padding: 8px 0;
            line-height: 1.5;
        }

        .delete-edit-actions {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 2px solid #e0e0e0;
        }

        .delete-edit-action-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .delete-edit-action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .delete-edit-action-btn-delete {
            background-color: #ff3b30;
            color: white;
        }

        .delete-edit-action-btn-delete:hover:not(:disabled) {
            background-color: #e6342a;
            transform: scale(1.02);
        }

        .delete-edit-action-btn-edit {
            background-color: #34c759;
            color: white;
        }

        .delete-edit-action-btn-edit:hover:not(:disabled) {
            background-color: #30b050;
            transform: scale(1.02);
        }

        .delete-edit-loading {
            text-align: center;
            padding: 40px 20px;
            color: #666;
            font-size: 14px;
        }

        .delete-edit-empty {
            text-align: center;
            padding: 40px 20px;
            color: #999;
            font-size: 14px;
        }

        .admin-form-group {
            margin-bottom: 20px;
        }

        .admin-form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
            color: #333;
        }

        .admin-form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #0088cc;
            border-radius: 8px;
            font-size: 14px;
            direction: rtl;
            outline: none;
            transition: border-color 0.2s;
            font-family: inherit;
            box-sizing: border-box;
        }

        .admin-form-input:focus {
            border-color: #0077b3;
        }

        .image-upload-area {
            margin-top: 8px;
        }

        .image-upload-area input[type="file"] {
            display: none;
        }

        .image-preview {
            margin-top: 12px;
            width: 100%;
            min-height: 200px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            background-color: #fafafa;
        }

        .image-preview:hover {
            border-color: #0088cc;
        }

        .image-upload-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            color: #666;
        }

        .upload-icon {
            font-size: 48px;
        }

        .upload-text {
            font-size: 14px;
        }

        .image-preview img {
            max-width: 100%;
            max-height: 400px;
            border-radius: 8px;
            object-fit: contain;
        }

        .admin-send-btn {
            width: 60px;
            height: 60px;
            background-color: #0088cc;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px auto 0;
            box-shadow: 0 2px 8px rgba(0, 136, 204, 0.3);
        }

        .admin-send-btn:hover {
            background-color: #0077b3;
            transform: scale(1.05);
        }

        .admin-send-btn:active {
            transform: scale(0.95);
        }

        .admin-send-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .send-icon {
            font-size: 24px;
            line-height: 1;
        }

        /* Colored Pages */
        .colored-page {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 3000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .colored-page.show {
            display: flex;
        }

        .colored-page.green {
            background-color: #34c759;
        }

        .colored-page.red {
            background-color: #ff3b30;
        }

        .colored-page-content {
            background-color: white;
            border-radius: 16px;
            padding: 24px;
            max-width: 400px;
            width: 100%;
            text-align: center;
        }

        .colored-page-content h2 {
            margin-bottom: 16px;
            color: #333;
        }

        .colored-page-close {
            margin-top: 20px;
            padding: 14px 28px;
            background: linear-gradient(135deg, var(--gold-primary) 0%, var(--gold-secondary) 100%);
            color: var(--black-primary);
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: var(--shadow-gold);
            transition: all 0.3s ease;
        }

        .colored-page-close:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(212, 175, 55, 0.35);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray-medium);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.6;
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 24px;
            color: var(--gold-primary);
            font-weight: 500;
            font-size: 15px;
        }

        /* Responsive adjustments */
        @media (max-width: 480px) {
            .header {
                padding: 10px 12px;
            }

            .content-area {
                padding: 12px;
            }

            .search-bar {
                padding: 10px 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header" id="mainHeader">
        <div class="header-content">
            <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                <div class="store-selector">
                    <button class="store-selector-btn" id="storeSelectorBtn">
                        Ø§Ù†ØªØ®Ø§Ø¨ Ù…ØºØ§Ø²Ù‡
                    </button>
                    <div class="store-dropdown" id="storeDropdown">
                        <div class="store-option" data-store="">Ø§Ù†ØªØ®Ø§Ø¨ Ù…ØºØ§Ø²Ù‡</div>
                        <div class="store-option" data-store="Ø¬ÙˆØ§Ù‡Ø±ÛŒ Ø³ØªØ§Ø±Ø²Ø§Ø¯Ù‡">Ø¬ÙˆØ§Ù‡Ø±ÛŒ Ø³ØªØ§Ø±Ø²Ø§Ø¯Ù‡</div>
                        <div class="store-option" data-store="ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Û±">ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Û±</div>
                        <div class="store-option" data-store="ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Û²">ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Û²</div>
                    </div>
                </div>
                <button class="address-btn" id="addressBtn">Ø¢Ø¯Ø±Ø³</button>
            </div>
            <div class="header-admin-buttons">
                <button class="header-admin-btn header-admin-btn-products" id="headerProductsBtn">10 Ù…Ø­ØµÙˆÙ„ Ø¢Ø®Ø±</button>
                <button class="header-admin-btn header-admin-btn-support" id="headerSupportBtn">Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ</button>
            </div>
            <button class="menu-btn" id="menuBtn"></button>
            <button class="back-btn" id="backBtn" style="display: none;"></button>
        </div>
    </div>

    <!-- Accordion Menu -->
    <div class="accordion-menu" id="accordionMenu">
        <div class="accordion-item" id="contactMenuItem">
            <div class="accordion-item-content">Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ù…Ø§</div>
        </div>
        <div class="accordion-item" id="loginMenuItem">
            <div class="accordion-item-content">ÙˆØ±ÙˆØ¯</div>
        </div>
        <div class="accordion-item" id="goldPriceMenuItem">
            <div class="accordion-item-content">Ù‚ÛŒÙ…Øª Ø±ÙˆØ² Ø·Ù„Ø§</div>
        </div>
    </div>

    <!-- Content Area -->
    <div class="content-area" id="mainContentArea">
        <div class="search-results chat-thread" id="searchResults">
            <div class="empty-state">
                <div class="empty-state-icon">ğŸ”</div>
                <div>Ø¨Ø±Ø§ÛŒ Ø¬Ø³ØªØ¬ÙˆØŒ Ù…ØªÙ† Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø± Ú©Ø§Ø¯Ø± Ù¾Ø§ÛŒÛŒÙ† ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</div>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div class="admin-dashboard" id="adminDashboard">
        <div class="admin-buttons-top"></div>
        <div class="admin-buttons-bottom">
            <button class="admin-btn admin-btn-update" id="updatePricesBtn">Ø¢Ù¾Ø¯ÛŒØª Ù‚ÛŒÙ…Øª Ù‡Ø§</button>
            <div class="admin-buttons-row">
                <button class="admin-btn admin-btn-add" id="addBtn">Ø§ÙØ²ÙˆØ¯Ù†</button>
                <button class="admin-btn admin-btn-delete" id="deleteEditBtn">Ø­Ø°Ù ÛŒØ§ Ø§Ø¯ÛŒØª</button>
            </div>
        </div>
    </div>

    <!-- Search Bar -->
    <div class="search-bar">
        <input type="text" class="search-input" id="searchInput" placeholder="Text box" />
        <button class="search-btn" id="searchBtn">â†‘</button>
    </div>

    <!-- Address Modal -->
    <div class="modal" id="addressModal">
        <div class="modal-content">
            <div class="modal-header">Ø¢Ø¯Ø±Ø³ ÙØ±ÙˆØ´Ú¯Ø§Ù‡</div>
            <div class="modal-body" id="modalAddress">
                Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" id="closeModalBtn">Ø¨Ø³ØªÙ†</button>
                <button class="modal-btn modal-btn-primary" id="viewMapBtn">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡</button>
            </div>
        </div>
    </div>

    <!-- Contact Us Modal -->
    <div class="modal" id="contactModal">
        <div class="modal-content">
            <div class="modal-header">Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ù…Ø§</div>
            <div class="modal-body">
                <form id="contactForm">
                    <div class="form-group">
                        <label class="form-label" for="contactName">Ù†Ø§Ù…</label>
                        <input type="text" class="form-input" id="contactName" required />
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="contactPhone">Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³</label>
                        <input type="tel" class="form-input" id="contactPhone" required />
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="contactText">Ù…ØªÙ†</label>
                        <textarea class="form-textarea" id="contactText" required></textarea>
                    </div>
                    <button type="submit" class="form-submit-btn" id="contactSubmitBtn">Ø§Ø±Ø³Ø§Ù„</button>
                </form>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" id="closeContactModalBtn">Ø¨Ø³ØªÙ†</button>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">ÙˆØ±ÙˆØ¯</div>
            <div class="modal-body">
                <form id="loginForm">
                    <div class="form-group">
                        <label class="form-label" for="loginUsername">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</label>
                        <input type="text" class="form-input" id="loginUsername" required />
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="loginPassword">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</label>
                        <input type="password" class="form-input" id="loginPassword" required />
                    </div>
                    <button type="submit" class="form-submit-btn" id="loginSubmitBtn">ÙˆØ±ÙˆØ¯</button>
                </form>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-primary" id="passwordResetBtn">ØªÙ†Ø¸ÛŒÙ… ÛŒØ§ ØªØºÛŒÛŒØ± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</button>
                <button class="modal-btn modal-btn-secondary" id="closeLoginModalBtn">Ø¨Ø³ØªÙ†</button>
            </div>
        </div>
    </div>

    <!-- Password Reset Modal -->
    <div class="modal" id="passwordResetModal">
        <div class="modal-content">
            <div class="modal-header">ØªÙ†Ø¸ÛŒÙ… ÛŒØ§ ØªØºÛŒÛŒØ± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</div>
            <div class="modal-body">
                <form id="passwordResetForm">
                    <div class="form-group">
                        <label class="form-label" for="passwordResetPhone">Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³</label>
                        <input type="tel" class="form-input" id="passwordResetPhone" required />
                    </div>
                    <button type="submit" class="form-submit-btn" id="passwordResetSubmitBtn">Ø§Ø±Ø³Ø§Ù„</button>
                </form>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" id="closePasswordResetModalBtn">Ø¨Ø³ØªÙ†</button>
            </div>
        </div>
    </div>

    <!-- Store Setup Modal -->
    <div class="modal" id="storeSetupModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">ØªÙ†Ø¸ÛŒÙ… Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙØ±ÙˆØ´Ú¯Ø§Ù‡</div>
            <div class="modal-body">
                <form id="storeSetupForm">
                    <div class="form-group">
                        <label class="form-label" for="storeSetupUsername">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</label>
                        <input type="text" class="form-input" id="storeSetupUsername" required />
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="storeSetupPassword">Ø§Ù†ØªØ®Ø§Ø¨ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</label>
                        <input type="password" class="form-input" id="storeSetupPassword" required />
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="storeSetupMobile">Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø«Ø¨Øª Ø´Ø¯Ù‡ Ø¯Ø± Ø§ÛŒÙ† Ø§Ù¾</label>
                        <input type="tel" class="form-input" id="storeSetupMobile" required />
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="storeSetupCode">Ú©Ø¯ 5 Ø±Ù‚Ù…ÛŒ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡</label>
                        <input type="text" class="form-input" id="storeSetupCode" placeholder="Ú©Ø¯ 5 Ø±Ù‚Ù…ÛŒ" maxlength="5" required />
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø´Ø§Ù…Ù„ Ù†Ø§Ù…ØŒ ØªÙ„ÙÙ† ØªÙ…Ø§Ø³ Ùˆ Ø¢Ø¯Ø±Ø³</label>
                        <input type="text" class="form-input" id="storeSetupName" placeholder="Ù†Ø§Ù… ÙØ±ÙˆØ´Ú¯Ø§Ù‡" required />
                        <input type="tel" class="form-input" id="storeSetupPhone" placeholder="ØªÙ„ÙÙ† ØªÙ…Ø§Ø³" required style="margin-top: 12px;" />
                        <input type="text" class="form-input" id="storeSetupAddress" placeholder="Ø¢Ø¯Ø±Ø³" required style="margin-top: 12px;" />
                    </div>
                    <div class="form-group">
                        <button type="button" class="form-submit-btn" id="storeSetupLocationBtn" style="background: var(--black-primary); color: var(--gold-primary); border: 2px solid var(--gold-primary); margin-top: 12px;">
                            Ø§Ø±Ø³Ø§Ù„ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ
                        </button>
                        <div id="storeSetupLocationDisplay" style="margin-top: 12px; padding: 12px; background: var(--gray-light); border-radius: 8px; display: none;">
                            <span id="storeSetupLocationText">Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯Ù‡</span>
                        </div>
                    </div>
                    <button type="submit" class="form-submit-btn" id="storeSetupSubmitBtn">Ø§Ø±Ø³Ø§Ù„</button>
                </form>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" id="closeStoreSetupModalBtn">Ø¨Ø³ØªÙ†</button>
            </div>
        </div>
    </div>

    <!-- Google Maps Location Picker Modal -->
    <div class="modal" id="locationPickerModal">
        <div class="modal-content" style="max-width: 90%; max-height: 90vh; width: 600px;">
            <div class="modal-header">Ø§Ù†ØªØ®Ø§Ø¨ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡</div>
            <div class="modal-body" style="padding: 0;">
                <div id="map" style="width: 100%; height: 400px; border-radius: 12px; overflow: hidden;"></div>
                <div style="padding: 16px;">
                    <div id="selectedLocationInfo" style="padding: 12px; background: var(--gray-light); border-radius: 8px; margin-top: 12px; display: none;">
                        <div style="font-weight: 600; margin-bottom: 8px;">Ù…ÙˆÙ‚Ø¹ÛŒØª Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡:</div>
                        <div id="selectedLocationText"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" id="closeLocationPickerModalBtn">Ù„ØºÙˆ</button>
                <button class="modal-btn modal-btn-primary" id="confirmLocationBtn">ØªØ£ÛŒÛŒØ¯ Ù…ÙˆÙ‚Ø¹ÛŒØª</button>
            </div>
        </div>
    </div>

    <!-- Gold Price Modal -->
    <div class="modal" id="goldPriceModal">
        <div class="modal-content">
            <div class="modal-header">Ù‚ÛŒÙ…Øª Ø±ÙˆØ² Ø·Ù„Ø§</div>
            <div class="modal-body">
                <div id="goldPriceContainer" class="gold-price-container">
                    <div class="loading">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" id="closeGoldPriceModalBtn">Ø¨Ø³ØªÙ†</button>
            </div>
        </div>
    </div>

    <!-- Support Modal -->
    <div class="modal" id="supportModal">
        <div class="modal-content">
            <div class="modal-header">Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ</div>
            <div class="modal-body">
                <form id="supportForm">
                    <div class="form-group">
                        <label class="form-label" for="supportText">Ù…ØªÙ†</label>
                        <textarea class="form-textarea" id="supportText" required></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="supportNumber">Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³</label>
                        <input type="tel" class="form-input" id="supportNumber" required />
                    </div>
                    <button type="submit" class="form-submit-btn" id="supportSubmitBtn">Ø§Ø±Ø³Ø§Ù„</button>
                </form>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" id="closeSupportModalBtn">Ø¨Ø³ØªÙ†</button>
            </div>
        </div>
    </div>

    <!-- Admin Delete/Edit Page -->
    <div class="admin-page" id="deleteEditPage" style="display: none;">
        <div class="admin-page-content">
            <button class="admin-page-back-btn" id="deleteEditPageBackBtn">â†</button>
            <div class="delete-edit-results" id="deleteEditResults" style="display: none;"></div>
            <div class="delete-edit-bottom-container">
                <label class="delete-edit-label" for="deleteEditInput">Ú©Ø¯ Ø·Ù„Ø§ ÛŒØ§ ØªÙˆØ¶ÛŒØ­Ø§Øª Ù…Ø­ØµÙˆÙ„</label>
                <form id="deleteEditForm" class="delete-edit-form">
                    <input type="text" class="delete-edit-input" id="deleteEditInput" required />
                    <button type="submit" class="delete-edit-send-btn" id="deleteEditSubmitBtn">
                        <span class="send-icon">â†‘</span>
                    </button>
                </form>
                <div class="delete-edit-actions" id="deleteEditActions" style="display: none;">
                    <button class="delete-edit-action-btn delete-edit-action-btn-delete" id="deleteActionBtn">Ø­Ø°Ù</button>
                    <button class="delete-edit-action-btn delete-edit-action-btn-edit" id="editActionBtn">Ø§Ø¯ÛŒØª</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Add Page -->
    <div class="admin-page" id="addPage" style="display: none;">
        <div class="admin-page-content">
            <button class="admin-page-back-btn" id="addPageBackBtn">â†</button>
            <form id="addForm">
                <div class="admin-form-group">
                    <label class="admin-form-label">Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØµÙˆÛŒØ±</label>
                    <div class="image-upload-area">
                        <input type="file" id="imageInput" accept="image/*" />
                        <div class="image-preview" id="imagePreview">
                            <div class="image-upload-placeholder">
                                <span class="upload-icon">ğŸ“</span>
                                <span class="upload-text">Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØµÙˆÛŒØ±</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="admin-form-group">
                    <label class="admin-form-label" for="goldCode">Ú©Ø¯ Ø·Ù„Ø§</label>
                    <input type="text" class="admin-form-input" id="goldCode" required />
                </div>
                <div class="admin-form-group">
                    <label class="admin-form-label" for="productDescription">ØªÙˆØ¶ÛŒØ­Ø§Øª Ù…Ø­ØµÙˆÙ„</label>
                    <input type="text" class="admin-form-input" id="productDescription" required />
                </div>
                <button type="submit" class="admin-send-btn" id="addSubmitBtn">
                    <span class="send-icon">â†‘</span>
                </button>
            </form>
        </div>
    </div>

    <!-- Colored Pages -->
    <div class="colored-page green" id="greenPage">
        <div class="colored-page-content">
            <h2>Ø¹Ù…Ù„ÛŒØ§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯</h2>
            <button class="colored-page-close" id="closeGreenPageBtn">Ø¨Ø³ØªÙ†</button>
        </div>
    </div>

    <div class="colored-page red" id="redPage">
        <div class="colored-page-content">
            <h2>Ø¹Ù…Ù„ÛŒØ§Øª Ø­Ø°Ù Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯</h2>
            <button class="colored-page-close" id="closeRedPageBtn">Ø¨Ø³ØªÙ†</button>
        </div>
    </div>

    <script>
        const WEBHOOK_URL = 'https://33140-nwo6p.s1.irann8n.com/webhook-test/df17942e-9b77-4e51-84e5-6301cd0a930b';
        const CONTACT_WEBHOOK_URL = 'https://33140-nwo6p.s1.irann8n.com/webhook-test/df17942e-9b77-4e51-84e5-6301cd0a930b';
        const GOLD_PRICE_WEBHOOK_URL = 'https://33140-nwo6p.s1.irann8n.com/webhook/bc5d867f-e95f-412f-921f-1819407f27fa';
        const LOGIN_WEBHOOK_URL = 'https://33140-nwo6p.s1.irann8n.com/webhook-test/de4e77d3-0c12-4309-8dd3-1f657b62bfb6';
        const ADMIN_WEBHOOK_URL = 'https://33140-nwo6p.s1.irann8n.com/webhook-test/0bb445e1-3e17-4af3-b6f5-668723e9a53c';
        const PAGE_NAVIGATION_WEBHOOK_URL = 'https://33140-nwo6p.s1.irann8n.com/webhook-test/91991a96-0cdd-4dbc-860b-3dc9729a1823';
        let isSending = false;
        
        // Token and user management
        function getToken() {
            return localStorage.getItem('authToken');
        }
        
        function getUsername() {
            return localStorage.getItem('username');
        }
        
        function setToken(token) {
            if (token) {
                localStorage.setItem('authToken', token);
            } else {
                localStorage.removeItem('authToken');
            }
        }
        
        function setUsername(username) {
            if (username) {
                localStorage.setItem('username', username);
            } else {
                localStorage.removeItem('username');
            }
        }
        
        function clearToken() {
            localStorage.removeItem('authToken');
            localStorage.removeItem('username');
        }

        // Check if user is authenticated
        function isAuthenticated() {
            const token = getToken();
            return token !== null && token !== undefined && token !== '';
        }

        // Redirect to login if not authenticated
        function requireAuth() {
            if (!isAuthenticated()) {
                clearToken();
                mainHeader.classList.remove('header-admin-mode');
                adminDashboard.classList.remove('show');
                if (typeof addPage !== 'undefined' && addPage) {
                    addPage.classList.remove('show');
                    addPage.style.display = 'none';
                }
                if (typeof deleteEditPage !== 'undefined' && deleteEditPage) {
                    deleteEditPage.classList.remove('show');
                    deleteEditPage.style.display = 'none';
                }
                mainContentArea.style.display = 'block';
                document.querySelector('.search-bar').style.display = 'flex';
                loginModal.classList.add('show');
                alert('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯');
                return false;
            }
            return true;
        }

        // Helper function to send authenticated requests with token and username
        async function sendAuthenticatedRequest(action, additionalData = {}) {
            const token = getToken();
            const username = getUsername();
            
            if (!token) {
                alert('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯');
                requireAuth();
                return null;
            }
            
            const payload = {
                action: action,
                token: token,
                username: username,
                timestamp: new Date().toISOString(),
                ...additionalData
            };
            
            try {
                const response = await fetch(ADMIN_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    if (errorData.message && (errorData.message.includes('token') || errorData.message.includes('unauthorized'))) {
                        clearToken();
                        requireAuth();
                        return null;
                    }
                    throw new Error(errorData.message || 'Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±');
                }
                
                return await response.json();
            } catch (error) {
                console.error(`Error in ${action}:`, error);
                throw error;
            }
        }

        // Store list
        const stores = ['Ø¬ÙˆØ§Ù‡Ø±ÛŒ Ø³ØªØ§Ø±Ø²Ø§Ø¯Ù‡', 'ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Û±', 'ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Û²'];
        let selectedStore = ''; // No store selected by default

        // DOM Elements
        const storeSelectorBtn = document.getElementById('storeSelectorBtn');
        const storeDropdown = document.getElementById('storeDropdown');
        const addressBtn = document.getElementById('addressBtn');
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const searchResults = document.getElementById('searchResults');
        const addressModal = document.getElementById('addressModal');
        const modalAddress = document.getElementById('modalAddress');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const viewMapBtn = document.getElementById('viewMapBtn');
        
        // Menu and Accordion Elements
        const menuBtn = document.getElementById('menuBtn');
        const backBtn = document.getElementById('backBtn');
        const accordionMenu = document.getElementById('accordionMenu');
        const contactMenuItem = document.getElementById('contactMenuItem');
        const loginMenuItem = document.getElementById('loginMenuItem');
        const goldPriceMenuItem = document.getElementById('goldPriceMenuItem');
        
        // Modal Elements
        const contactModal = document.getElementById('contactModal');
        const loginModal = document.getElementById('loginModal');
        const passwordResetModal = document.getElementById('passwordResetModal');
        const storeSetupModal = document.getElementById('storeSetupModal');
        const goldPriceModal = document.getElementById('goldPriceModal');
        const contactForm = document.getElementById('contactForm');
        const loginForm = document.getElementById('loginForm');
        const passwordResetForm = document.getElementById('passwordResetForm');
        const storeSetupForm = document.getElementById('storeSetupForm');
        const contactSubmitBtn = document.getElementById('contactSubmitBtn');
        const loginSubmitBtn = document.getElementById('loginSubmitBtn');
        const passwordResetSubmitBtn = document.getElementById('passwordResetSubmitBtn');
        const storeSetupSubmitBtn = document.getElementById('storeSetupSubmitBtn');
        const storeSetupLocationBtn = document.getElementById('storeSetupLocationBtn');
        const storeSetupLocationDisplay = document.getElementById('storeSetupLocationDisplay');
        const storeSetupLocationText = document.getElementById('storeSetupLocationText');
        const passwordResetBtn = document.getElementById('passwordResetBtn');
        const closeContactModalBtn = document.getElementById('closeContactModalBtn');
        const closeLoginModalBtn = document.getElementById('closeLoginModalBtn');
        const closePasswordResetModalBtn = document.getElementById('closePasswordResetModalBtn');
        const closeStoreSetupModalBtn = document.getElementById('closeStoreSetupModalBtn');
        const closeGoldPriceModalBtn = document.getElementById('closeGoldPriceModalBtn');
        const goldPriceContainer = document.getElementById('goldPriceContainer');
        
        // Admin Dashboard Elements
        const mainHeader = document.getElementById('mainHeader');
        const mainContentArea = document.getElementById('mainContentArea');
        const adminDashboard = document.getElementById('adminDashboard');
        const headerSupportBtn = document.getElementById('headerSupportBtn');
        const headerProductsBtn = document.getElementById('headerProductsBtn');
        const updatePricesBtn = document.getElementById('updatePricesBtn');
        const deleteEditBtn = document.getElementById('deleteEditBtn');
        const addBtn = document.getElementById('addBtn');
        const supportModal = document.getElementById('supportModal');
        const supportForm = document.getElementById('supportForm');
        const supportSubmitBtn = document.getElementById('supportSubmitBtn');
        const closeSupportModalBtn = document.getElementById('closeSupportModalBtn');
        const greenPage = document.getElementById('greenPage');
        const redPage = document.getElementById('redPage');
        const closeGreenPageBtn = document.getElementById('closeGreenPageBtn');
        const closeRedPageBtn = document.getElementById('closeRedPageBtn');
        const addPage = document.getElementById('addPage');
        const addForm = document.getElementById('addForm');
        const imageInput = document.getElementById('imageInput');
        const imagePreview = document.getElementById('imagePreview');
        const addSubmitBtn = document.getElementById('addSubmitBtn');
        const addPageBackBtn = document.getElementById('addPageBackBtn');
        const deleteEditPage = document.getElementById('deleteEditPage');
        const deleteEditForm = document.getElementById('deleteEditForm');
        const deleteEditInput = document.getElementById('deleteEditInput');
        const deleteEditSubmitBtn = document.getElementById('deleteEditSubmitBtn');
        const deleteEditPageBackBtn = document.getElementById('deleteEditPageBackBtn');
        const deleteEditResults = document.getElementById('deleteEditResults');
        const deleteEditActions = document.getElementById('deleteEditActions');
        const deleteActionBtn = document.getElementById('deleteActionBtn');
        const editActionBtn = document.getElementById('editActionBtn');

        // Store selector functionality
        storeSelectorBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            storeDropdown.classList.toggle('show');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            if (!storeSelectorBtn.contains(e.target) && !storeDropdown.contains(e.target)) {
                storeDropdown.classList.remove('show');
            }
        });

        // Store option selection
        storeDropdown.querySelectorAll('.store-option').forEach(option => {
            option.addEventListener('click', function() {
                selectedStore = this.getAttribute('data-store');
                const displayText = selectedStore || 'Ø§Ù†ØªØ®Ø§Ø¨ Ù…ØºØ§Ø²Ù‡';
                storeSelectorBtn.textContent = displayText;
                storeDropdown.classList.remove('show');
            });
        });

        function clearEmptyState() {
            const emptyState = searchResults.querySelector('.empty-state');
            if (emptyState) {
                emptyState.remove();
            }
        }

        function scrollToBottom() {
            searchResults.scrollTop = searchResults.scrollHeight;
        }

        function appendMessage(role, content, options = {}) {
            clearEmptyState();

            const messageEl = document.createElement('div');
            messageEl.classList.add('message', role === 'user' ? 'message-user' : 'message-bot');

            if (options.isPending) {
                messageEl.classList.add('typing-dots');
            }

            if (typeof content === 'string') {
                messageEl.textContent = content;
            } else if (content instanceof Node) {
                messageEl.appendChild(content);
            } else {
                messageEl.textContent = '';
            }

            searchResults.appendChild(messageEl);
            scrollToBottom();

            return messageEl;
        }

        function updateMessage(messageEl, content) {
            if (!messageEl) return;
            messageEl.classList.remove('typing-dots');

            if (typeof content === 'string') {
                messageEl.textContent = content;
            } else if (content instanceof Node) {
                messageEl.innerHTML = '';
                messageEl.appendChild(content);
            } else {
                messageEl.textContent = '';
            }

            scrollToBottom();
        }

        function setSearchState(isLoading) {
            isSending = isLoading;
            searchBtn.disabled = isLoading;
            if (isLoading) {
                // Show loading indicator on button
                searchBtn.textContent = 'â³';
                searchBtn.style.opacity = '0.7';
            } else {
                // Restore normal button state
                searchBtn.textContent = 'â†‘';
                searchBtn.style.opacity = '1';
                searchInput.focus();
            }
        }

        function createTextContent(text) {
            const wrapper = document.createElement('div');
            wrapper.className = 'message-text';
            wrapper.textContent = text;
            return wrapper;
        }

        function createImageContent({ url, caption }) {
            const figure = document.createElement('figure');
            figure.className = 'message-media';

            const img = document.createElement('img');
            img.src = url;
            img.alt = caption || 'ØªØµÙˆÛŒØ±';
            img.loading = 'lazy';
            figure.appendChild(img);

            if (caption) {
                const figcaption = document.createElement('figcaption');
                figcaption.textContent = caption;
                figure.appendChild(figcaption);
            }

            return figure;
        }

        function createLocationContent({ latitude, longitude, text }) {
            const container = document.createElement('div');
            container.className = 'message-location';

            const description = document.createElement('div');
            description.textContent = text || 'Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ±ÙˆØ´Ú¯Ø§Ù‡';

            const link = document.createElement('a');
            link.href = `https://www.google.com/maps?q=${latitude},${longitude}`;
            link.target = '_blank';
            link.rel = 'noopener noreferrer';
            link.textContent = 'Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡';

            const coords = document.createElement('div');
            coords.className = 'location-coords';
            coords.textContent = `${latitude}, ${longitude}`;

            container.appendChild(description);
            container.appendChild(coords);
            container.appendChild(link);

            return container;
        }

        function detectInlineImageSource(value) {
            if (!value && value !== 0) {
                return null;
            }

            const trimmed = String(value).trim();

            if (!trimmed) {
                return null;
            }

            if (trimmed.startsWith('data:image')) {
                return trimmed;
            }

            if (/^https?:\/\/.+\.(png|jpe?g|gif|webp)(\?.*)?$/i.test(trimmed)) {
                return trimmed;
            }

            const sanitized = trimmed.replace(/\s+/g, '');
            const base64Hints = ['iVBOR', '/9j', 'R0lGOD', 'Qk2', 'Qk0', 'AAAB', 'UEsD'];
            const looksBase64 = /^[A-Za-z0-9+/=]+$/.test(sanitized) && base64Hints.some(hint => sanitized.startsWith(hint));

            if (looksBase64) {
                let mime = 'image/jpeg';
                if (sanitized.startsWith('iVBOR')) mime = 'image/png';
                else if (sanitized.startsWith('R0lGOD')) mime = 'image/gif';
                else if (sanitized.startsWith('Qk')) mime = 'image/bmp';

                return `data:${mime};base64,${sanitized}`;
            }

            return null;
        }

        function inferResponseType(data) {
            if (!data || typeof data !== 'object') {
                return 'text';
            }

            if (data.type) {
                return data.type;
            }

            if (data.latitude || data.lat) {
                return 'location';
            }

            if (data.url || data.image || data.image_url || data.photo) {
                return 'image';
            }

            return 'text';
        }

        const ARRAY_KEYS = [
            'items',
            'results',
            'data',
            'messages',
            'entries',
            'list',
            'payload',
            'value',
            'photos',
            'images',
            'media',
            'gallery',
            'files'
        ];

        function normalizeResponse(raw) {
            if (raw === null || raw === undefined) {
                return [];
            }

            if (typeof raw === 'string' || typeof raw === 'number') {
                const value = String(raw).trim();
                const inlineImage = detectInlineImageSource(value);
                if (inlineImage) {
                    return [{ type: 'image', url: inlineImage }];
                }
                return [{ type: 'text', text: value }];
            }

            if (Array.isArray(raw)) {
                return raw.flatMap(item => normalizeResponse(item));
            }

            if (typeof raw === 'object') {
                for (const key of ARRAY_KEYS) {
                    if (Array.isArray(raw[key])) {
                        const expanded = raw[key].flatMap(item => normalizeResponse(item));
                        if (expanded.length) {
                            return expanded;
                        }
                    }
                }

                const type = inferResponseType(raw);
                if (type === 'image') {
                    let source = raw.url || raw.image || raw.image_url || raw.photo;
                    if (!source && raw.data) {
                        source = detectInlineImageSource(raw.data);
                        if (!source) {
                            const mime = raw.mime || raw.mimetype || 'image/jpeg';
                            source = `data:${mime};base64,${String(raw.data).replace(/\s+/g, '')}`;
                        }
                    }

                    if (source) {
                        return [{
                            type: 'image',
                            url: source,
                            caption: raw.caption || raw.info || raw.text || raw.description || ''
                        }];
                    }
                }

                if (type === 'location') {
                    return [{
                        type: 'location',
                        latitude: raw.latitude || raw.lat,
                        longitude: raw.longitude || raw.lng || raw.lon,
                        text: raw.text || raw.caption || raw.description || ''
                    }];
                }

                const text = raw.text || raw.message || raw.caption || raw.description;
                if (text) {
                    return [{ type: 'text', text }];
                }

                return [{ type: 'text', text: JSON.stringify(raw, null, 2) }];
            }

            return [{ type: 'text', text: String(raw) }];
        }

        async function extractResponses(response) {
            const rawContentType = response.headers.get('content-type') || '';
            const contentType = rawContentType.toLowerCase();
            const disposition = response.headers.get('content-disposition') || '';
            const filenameSuggestsImage = /\.(png|jpe?g|gif|webp)/i.test(disposition);
            const isImage = contentType.startsWith('image/');
            const isBinary = contentType === 'application/octet-stream';

            if (isImage || isBinary || (!contentType && filenameSuggestsImage)) {
                const blob = await response.blob();
                const objectUrl = URL.createObjectURL(blob);
                return [{
                    type: 'image',
                    url: objectUrl,
                    caption: response.headers.get('x-caption') || ''
                }];
            }

            let payload;
            try {
                if (contentType.includes('application/json')) {
                    payload = await response.json();
                } else if (contentType.startsWith('text/') || contentType.includes('xml') || contentType.includes('html') || !contentType) {
                    const text = await response.text();
                    try {
                        payload = text ? JSON.parse(text) : '';
                    } catch {
                        payload = text;
                    }
                } else {
                    const blob = await response.blob();
                    const objectUrl = URL.createObjectURL(blob);
                    return [{
                        type: 'image',
                        url: objectUrl,
                        caption: response.headers.get('x-caption') || ''
                    }];
                }
            } catch (error) {
                console.error('Failed to parse response payload:', error);
                payload = '';
            }

            return normalizeResponse(payload);
        }

        function renderMessageContent(targetEl, payload) {
            if (!payload) {
                updateMessage(targetEl, 'Ù¾Ø§Ø³Ø®ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯');
                return;
            }

            if (payload.type === 'image' && payload.url) {
                updateMessage(targetEl, createImageContent(payload));
                return;
            }

            if (payload.type === 'location' && payload.latitude && payload.longitude) {
                updateMessage(targetEl, createLocationContent(payload));
                return;
            }

            updateMessage(targetEl, createTextContent(payload.text || 'Ù¾Ø§Ø³Ø®ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯'));
        }

        async function sendSearchQuery() {
            if (isSending) {
                return;
            }

            const query = searchInput.value.trim();

            if (!query) {
                return;
            }

            searchInput.value = '';

            appendMessage('user', query);

            // Show pending message and proceed (send to backend even if no store selected)
            const botPlaceholder = appendMessage('bot', 'Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ù¾Ø§Ø³Ø®...', { isPending: true });
            setSearchState(true);

            const payload = {
                store: selectedStore,
                query,
                timestamp: new Date().toISOString()
            };

            try {
                const response = await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                const responses = await extractResponses(response);

                if (!response.ok) {
                    const message = responses[0]?.text || 'Ø®Ø·Ø§ÛŒ Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡';
                    throw new Error(message);
                }

                if (!responses.length) {
                    updateMessage(botPlaceholder, 'Ù¾Ø§Ø³Ø®ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯');
                } else {
                    renderMessageContent(botPlaceholder, responses[0]);
                    if (responses.length > 1) {
                        responses.slice(1).forEach(item => {
                            const extraMessage = appendMessage('bot', '');
                            renderMessageContent(extraMessage, item);
                        });
                    }
                }
            } catch (error) {
                console.error('n8n webhook error:', error);
                updateMessage(botPlaceholder, 'Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù¾Ø§Ø³Ø®. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.');
            } finally {
                setSearchState(false);
            }
        }

        // Search button click
        searchBtn.addEventListener('click', sendSearchQuery);

        // Enter key in search input
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendSearchQuery();
            }
        });

        // Address functionality
        function showAddressLocation() {
            // Check if store is selected
            if (!selectedStore || selectedStore === '') {
                alert('Ø§Ø¨ØªØ¯Ø§ Ù…ØºØ§Ø²Ù‡ Ø®ÙˆØ¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.');
                return;
            }
            
            // Show modal
            addressModal.classList.add('show');
            modalAddress.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ø¯Ø±Ø³...';

            // Prepare data for n8n webhook
            const webhookData = {
                store: selectedStore,
                action: 'get_address',
                timestamp: new Date().toISOString()
            };

            // Log to console (simulating webhook call)
            console.log('Sending address request to n8n Webhook:', webhookData);
            console.log('POST URL: https://your-n8n-webhook-url.com/webhook/address');

            // Simulate API call delay
            setTimeout(() => {
                // Mock address data
                const mockAddress = {
                    text: 'ØªÙ‡Ø±Ø§Ù†ØŒ Ø®ÛŒØ§Ø¨Ø§Ù† ÙˆÙ„ÛŒØ¹ØµØ±ØŒ Ù¾Ù„Ø§Ú© Û±Û²Û³ØŒ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø¬ÙˆØ§Ù‡Ø±ÛŒ Ø³ØªØ§Ø±Ø²Ø§Ø¯Ù‡',
                    latitude: 35.6892,
                    longitude: 51.3890
                };

                modalAddress.textContent = mockAddress.text;
                
                // Store coordinates for map view
                viewMapBtn.onclick = function() {
                    openGoogleMaps(mockAddress.latitude, mockAddress.longitude);
                };
            }, 500);
        }

        function openGoogleMaps(lat, lng) {
            const url = `https://www.google.com/maps?q=${lat},${lng}`;
            window.open(url, '_blank');
        }

        // Address button click
        addressBtn.addEventListener('click', showAddressLocation);

        // Modal close functionality
        closeModalBtn.addEventListener('click', function() {
            addressModal.classList.remove('show');
        });

        // Close modal when clicking outside
        addressModal.addEventListener('click', function(e) {
            if (e.target === addressModal) {
                addressModal.classList.remove('show');
            }
        });

        // Menu button click - toggle accordion
        menuBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            accordionMenu.classList.toggle('show');
        });

        // Close accordion when clicking outside
        document.addEventListener('click', function(e) {
            if (!menuBtn.contains(e.target) && !accordionMenu.contains(e.target)) {
                accordionMenu.classList.remove('show');
            }
        });

        // Accordion menu item clicks
        contactMenuItem.addEventListener('click', function() {
            accordionMenu.classList.remove('show');
            contactModal.classList.add('show');
        });

        loginMenuItem.addEventListener('click', function() {
            accordionMenu.classList.remove('show');
            loginModal.classList.add('show');
        });

        goldPriceMenuItem.addEventListener('click', async function() {
            accordionMenu.classList.remove('show');
            goldPriceModal.classList.add('show');
            goldPriceContainer.innerHTML = '<div class="loading">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>';
            
            try {
                const response = await fetch('https://33140-nwo6p.s1.irann8n.com/webhook-test/5906c811-a199-49c6-bd96-1f2e1cdf6e53', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'get_gold_prices',
                        username: 'users',
                        timestamp: new Date().toISOString()
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Failed to fetch gold prices');
                }
                
                const data = await response.json();
                displayGoldPrices(data);
            } catch (error) {
                console.error('Gold price error:', error);
                goldPriceContainer.innerHTML = '<div class="loading" style="color: #ff3b30;">Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.</div>';
            }
        });

        // Contact form submission
        contactForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const name = document.getElementById('contactName').value.trim();
            const phone = document.getElementById('contactPhone').value.trim();
            const text = document.getElementById('contactText').value.trim();

            if (!name || !phone || !text) {
                alert('Ù„Ø·ÙØ§Ù‹ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯');
                return;
            }

            contactSubmitBtn.disabled = true;
            contactSubmitBtn.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„...';

            try {
                const response = await fetch(CONTACT_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'contact',
                        name: name,
                        phone: phone,
                        text: text,
                        timestamp: new Date().toISOString()
                    })
                });

                if (response.ok) {
                    alert('Ù¾ÛŒØ§Ù… Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯');
                    contactForm.reset();
                    contactModal.classList.remove('show');
                } else {
                    alert('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.');
                }
            } catch (error) {
                console.error('Contact form error:', error);
                alert('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.');
            } finally {
                contactSubmitBtn.disabled = false;
                contactSubmitBtn.textContent = 'Ø§Ø±Ø³Ø§Ù„';
            }
        });

        // Login form submission
        loginForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value.trim();

            if (!username || !password) {
                alert('Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ùˆ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                return;
            }

            loginSubmitBtn.disabled = true;
            loginSubmitBtn.textContent = 'Ø¯Ø± Ø­Ø§Ù„ ÙˆØ±ÙˆØ¯...';

            try {
                const response = await fetch(LOGIN_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'login',
                        username: username,
                        password: password,
                        timestamp: new Date().toISOString()
                    })
                });

                const data = await response.json();
                
                if (response.ok && data.token) {
                    // Store the token and username
                    setToken(data.token);
                    setUsername(username);
                    loginForm.reset();
                    loginModal.classList.remove('show');
                    // Show admin dashboard and hide main content
                    mainContentArea.style.display = 'none';
                    document.querySelector('.search-bar').style.display = 'none';
                    mainHeader.classList.add('header-admin-mode');
                    adminDashboard.classList.add('show');
                } else {
                    alert(data.message || 'Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª');
                }
            } catch (error) {
                console.error('Login error:', error);
                alert('Ø®Ø·Ø§ Ø¯Ø± ÙˆØ±ÙˆØ¯. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.');
            } finally {
                loginSubmitBtn.disabled = false;
                loginSubmitBtn.textContent = 'ÙˆØ±ÙˆØ¯';
            }
        });

        // Back button handler
        backBtn.addEventListener('click', function() {
            // If on add page, go back to admin dashboard
            if (addPage && (addPage.style.display === 'block' || addPage.classList.contains('show'))) {
                addPage.classList.remove('show');
                addPage.style.display = 'none';
                adminDashboard.classList.add('show');
                backBtn.style.display = 'none';
                return;
            }
            
            // If on delete/edit page, go back to admin dashboard
            if (deleteEditPage && (deleteEditPage.style.display === 'block' || deleteEditPage.classList.contains('show'))) {
                deleteEditPage.classList.remove('show');
                deleteEditPage.style.display = 'none';
                adminDashboard.classList.add('show');
                backBtn.style.display = 'none';
                return;
            }
            
            // Otherwise, clear token and go back to main page
            clearToken();
            mainHeader.classList.remove('header-admin-mode');
            adminDashboard.classList.remove('show');
            mainContentArea.style.display = 'block';
            document.querySelector('.search-bar').style.display = 'flex';
            
            // Clear search results (images from "10 Ù…Ø­ØµÙˆÙ„ Ø¢Ø®Ø±")
            searchResults.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ”</div><div>Ø¨Ø±Ø§ÛŒ Ø¬Ø³ØªØ¬ÙˆØŒ Ù†ÙˆØ¹ Ø·Ù„Ø§ Ùˆ Ù‚ÛŒÙ…Øª Ø±Ø§ Ø¯Ø± Ú©Ø§Ø¯Ø± Ù¾Ø§ÛŒÛŒÙ† ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</div></div>';
        });

        // Fetch gold prices
        async function fetchGoldPrices() {
            goldPriceContainer.innerHTML = '<div class="loading">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>';

            try {
                const response = await fetch(GOLD_PRICE_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'get_gold_prices',
                        timestamp: new Date().toISOString()
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to fetch gold prices');
                }

                const data = await response.json();
                displayGoldPrices(data);
            } catch (error) {
                console.error('Gold price error:', error);
                goldPriceContainer.innerHTML = '<div class="loading" style="color: #ff3b30;">Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.</div>';
            }
        }

        // Display gold prices
        function displayGoldPrices(data) {
            if (!data || typeof data !== 'object') {
                goldPriceContainer.innerHTML = '<div class="loading">Ø§Ø·Ù„Ø§Ø¹Ø§ØªÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯</div>';
                return;
            }

            let html = '';
            
            // If data is an array
            if (Array.isArray(data)) {
                data.forEach(item => {
                    if (typeof item === 'object') {
                        Object.entries(item).forEach(([key, value]) => {
                            html += `
                                <div class="gold-price-item">
                                    <span class="gold-price-label">${key}</span>
                                    <span class="gold-price-value">${value}</span>
                                </div>
                            `;
                        });
                    }
                });
            } else {
                // If data is an object
                Object.entries(data).forEach(([key, value]) => {
                    if (typeof value === 'object' && value !== null) {
                        html += `
                            <div class="gold-price-item" style="flex-direction: column; align-items: flex-start; gap: 8px;">
                                <span class="gold-price-label" style="font-size: 16px; font-weight: 600;">${key}</span>
                        `;
                        Object.entries(value).forEach(([subKey, subValue]) => {
                            html += `
                                <div style="display: flex; justify-content: space-between; width: 100%; padding-right: 16px;">
                                    <span class="gold-price-label">${subKey}</span>
                                    <span class="gold-price-value">${subValue}</span>
                                </div>
                            `;
                        });
                        html += `</div>`;
                    } else {
                        html += `
                            <div class="gold-price-item">
                                <span class="gold-price-label">${key}</span>
                                <span class="gold-price-value">${value}</span>
                            </div>
                        `;
                    }
                });
            }

            goldPriceContainer.innerHTML = html || '<div class="loading">Ø§Ø·Ù„Ø§Ø¹Ø§ØªÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯</div>';
        }

        // Close modals
        closeContactModalBtn.addEventListener('click', function() {
            contactModal.classList.remove('show');
        });

        closeLoginModalBtn.addEventListener('click', function() {
            loginModal.classList.remove('show');
        });

        closeGoldPriceModalBtn.addEventListener('click', function() {
            goldPriceModal.classList.remove('show');
        });

        closePasswordResetModalBtn.addEventListener('click', function() {
            passwordResetModal.classList.remove('show');
        });

        closeStoreSetupModalBtn.addEventListener('click', function() {
            storeSetupModal.classList.remove('show');
        });

        // Password reset button click
        passwordResetBtn.addEventListener('click', function() {
            loginModal.classList.remove('show');
            passwordResetModal.classList.add('show');
        });

        // Password reset form submission
        passwordResetForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const phone = document.getElementById('passwordResetPhone').value.trim();

            if (!phone) {
                alert('Ù„Ø·ÙØ§Ù‹ Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                return;
            }

            passwordResetSubmitBtn.disabled = true;
            passwordResetSubmitBtn.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„...';

            try {
                const response = await fetch(LOGIN_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'reset_password',
                        phone: phone,
                        timestamp: new Date().toISOString()
                    })
                });

                if (!response.ok) {
                    throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª');
                }

                const data = await response.json();
                if (response.ok) {
                    // Check if response contains "login/setting_pass" to redirect to store setup
                    const responseText = JSON.stringify(data).toLowerCase();
                    const nextPage = data.nextPage || data.nextpage || '';
                    
                    if (nextPage === 'login/setting_pass' || responseText.includes('login/setting_pass') || responseText.includes('setting_pass')) {
                        passwordResetModal.classList.remove('show');
                        storeSetupModal.classList.add('show');
                        // Pre-fill mobile number in the correct field
                        document.getElementById('storeSetupMobile').value = phone;
                    } else {
                        alert('Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯');
                        passwordResetForm.reset();
                        passwordResetModal.classList.remove('show');
                    }
                }
            } catch (error) {
                console.error('Password reset error:', error);
                alert('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.');
            } finally {
                passwordResetSubmitBtn.disabled = false;
                passwordResetSubmitBtn.textContent = 'Ø§Ø±Ø³Ø§Ù„';
            }
        });

        // Store location data
        let storeLocationData = null;
        let map = null;
        let marker = null;
        let selectedLocation = null;

        // Initialize Google Maps when location picker modal opens
        function initLocationPicker() {
            if (typeof google === 'undefined' || !google.maps) {
                alert('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†Ù‚Ø´Ù‡. Ù„Ø·ÙØ§Ù‹ ØµÙØ­Ù‡ Ø±Ø§ Ø±ÙØ±Ø´ Ú©Ù†ÛŒØ¯ ÛŒØ§ API key Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.');
                locationPickerModal.classList.remove('show');
                return;
            }
            
            if (!map) {
                // Default to Tehran, Iran
                const defaultLocation = { lat: 35.6892, lng: 51.3890 };
                
                map = new google.maps.Map(document.getElementById('map'), {
                    center: defaultLocation,
                    zoom: 13,
                    mapTypeControl: true,
                    streetViewControl: true,
                    fullscreenControl: true
                });

                // Try to get user's current location
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        function(position) {
                            const userLocation = {
                                lat: position.coords.latitude,
                                lng: position.coords.longitude
                            };
                            map.setCenter(userLocation);
                            map.setZoom(15);
                            
                            // Add initial marker
                            marker = new google.maps.Marker({
                                position: userLocation,
                                map: map,
                                draggable: true,
                                title: 'Ù…ÙˆÙ‚Ø¹ÛŒØª Ø´Ù…Ø§'
                            });
                            
                            selectedLocation = userLocation;
                            updateLocationInfo(userLocation);
                            
                            // Add click listener to map
                            map.addListener('click', function(e) {
                                const clickedLocation = {
                                    lat: e.latLng.lat(),
                                    lng: e.latLng.lng()
                                };
                                
                                if (marker) {
                                    marker.setPosition(clickedLocation);
                                } else {
                                    marker = new google.maps.Marker({
                                        position: clickedLocation,
                                        map: map,
                                        draggable: true
                                    });
                                }
                                
                                selectedLocation = clickedLocation;
                                updateLocationInfo(clickedLocation);
                            });
                            
                            // Update location when marker is dragged
                            marker.addListener('dragend', function(e) {
                                const draggedLocation = {
                                    lat: e.latLng.lat(),
                                    lng: e.latLng.lng()
                                };
                                selectedLocation = draggedLocation;
                                updateLocationInfo(draggedLocation);
                            });
                        },
                        function(error) {
                            // If geolocation fails, use default location
                            marker = new google.maps.Marker({
                                position: defaultLocation,
                                map: map,
                                draggable: true
                            });
                            
                            selectedLocation = defaultLocation;
                            updateLocationInfo(defaultLocation);
                            
                            // Add click listener to map
                            map.addListener('click', function(e) {
                                const clickedLocation = {
                                    lat: e.latLng.lat(),
                                    lng: e.latLng.lng()
                                };
                                
                                if (marker) {
                                    marker.setPosition(clickedLocation);
                                } else {
                                    marker = new google.maps.Marker({
                                        position: clickedLocation,
                                        map: map,
                                        draggable: true
                                    });
                                }
                                
                                selectedLocation = clickedLocation;
                                updateLocationInfo(clickedLocation);
                            });
                            
                            // Update location when marker is dragged
                            marker.addListener('dragend', function(e) {
                                const draggedLocation = {
                                    lat: e.latLng.lat(),
                                    lng: e.latLng.lng()
                                };
                                selectedLocation = draggedLocation;
                                updateLocationInfo(draggedLocation);
                            });
                        }
                    );
                } else {
                    // Fallback if geolocation is not available
                    marker = new google.maps.Marker({
                        position: defaultLocation,
                        map: map,
                        draggable: true
                    });
                    
                    selectedLocation = defaultLocation;
                    updateLocationInfo(defaultLocation);
                    
                    // Add click listener to map
                    map.addListener('click', function(e) {
                        const clickedLocation = {
                            lat: e.latLng.lat(),
                            lng: e.latLng.lng()
                        };
                        
                        if (marker) {
                            marker.setPosition(clickedLocation);
                        } else {
                            marker = new google.maps.Marker({
                                position: clickedLocation,
                                map: map,
                                draggable: true
                            });
                        }
                        
                        selectedLocation = clickedLocation;
                        updateLocationInfo(clickedLocation);
                    });
                    
                    // Update location when marker is dragged
                    marker.addListener('dragend', function(e) {
                        const draggedLocation = {
                            lat: e.latLng.lat(),
                            lng: e.latLng.lng()
                        };
                        selectedLocation = draggedLocation;
                        updateLocationInfo(draggedLocation);
                    });
                }
            }
        }

        function updateLocationInfo(location) {
            selectedLocationText.textContent = `Ø¹Ø±Ø¶ Ø¬ØºØ±Ø§ÙÛŒØ§ÛŒÛŒ: ${location.lat.toFixed(6)}, Ø·ÙˆÙ„ Ø¬ØºØ±Ø§ÙÛŒØ§ÛŒÛŒ: ${location.lng.toFixed(6)}`;
            selectedLocationInfo.style.display = 'block';
        }

        // Store setup location button - opens Google Maps picker
        storeSetupLocationBtn.addEventListener('click', function() {
            locationPickerModal.classList.add('show');
            // Initialize map when modal opens - wait for Google Maps API to load
            function tryInitMap() {
                if (typeof google !== 'undefined' && google.maps) {
                    initLocationPicker();
                } else {
                    setTimeout(tryInitMap, 100);
                }
            }
            tryInitMap();
        });

        // Close location picker modal
        closeLocationPickerModalBtn.addEventListener('click', function() {
            locationPickerModal.classList.remove('show');
        });

        // Confirm location button
        confirmLocationBtn.addEventListener('click', function() {
            if (selectedLocation) {
                storeLocationData = {
                    latitude: selectedLocation.lat,
                    longitude: selectedLocation.lng
                };
                storeSetupLocationText.textContent = `Ù…ÙˆÙ‚Ø¹ÛŒØª: ${selectedLocation.lat.toFixed(6)}, ${selectedLocation.lng.toFixed(6)}`;
                storeSetupLocationDisplay.style.display = 'block';
                locationPickerModal.classList.remove('show');
            } else {
                alert('Ù„Ø·ÙØ§Ù‹ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø±Ø§ Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯');
            }
        });

        // Close location picker when clicking outside
        locationPickerModal.addEventListener('click', function(e) {
            if (e.target === locationPickerModal) {
                locationPickerModal.classList.remove('show');
            }
        });

        // Store setup form submission
        storeSetupForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('storeSetupUsername').value.trim();
            const password = document.getElementById('storeSetupPassword').value.trim();
            const mobile = document.getElementById('storeSetupMobile').value.trim();
            const code = document.getElementById('storeSetupCode').value.trim();
            const storeName = document.getElementById('storeSetupName').value.trim();
            const storePhone = document.getElementById('storeSetupPhone').value.trim();
            const storeAddress = document.getElementById('storeSetupAddress').value.trim();

            if (!username || !password || !mobile || !code || !storeName || !storePhone || !storeAddress) {
                alert('Ù„Ø·ÙØ§Ù‹ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯');
                return;
            }

            if (code.length !== 5) {
                alert('Ú©Ø¯ Ø¨Ø§ÛŒØ¯ 5 Ø±Ù‚Ù…ÛŒ Ø¨Ø§Ø´Ø¯');
                return;
            }

            storeSetupSubmitBtn.disabled = true;
            storeSetupSubmitBtn.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„...';

            try {
                const response = await fetch(LOGIN_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'store_setup',
                        username: username,
                        password: password,
                        mobile: mobile,
                        code: code,
                        storeName: storeName,
                        storePhone: storePhone,
                        storeAddress: storeAddress,
                        location: storeLocationData,
                        timestamp: new Date().toISOString()
                    })
                });

                if (!response.ok) {
                    throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª');
                }

                const data = await response.json();
                if (response.ok) {
                    // Get nextPage value first (before closing modal)
                    const nextPage = data.nextPage || data.nextpage || '';
                    // Also check if response text contains login/setting_pass
                    const responseText = JSON.stringify(data).toLowerCase();
                    const hasSettingPass = nextPage === 'login/setting_pass' || nextPage === 'login/setting_pass/' || 
                                          responseText.includes('login/setting_pass') || responseText.includes('setting_pass');
                    
                    // Show message from backend if available
                    const message = data.message || 'Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯';
                    alert(message);
                    
                    // Handle nextPage redirect
                    if (nextPage || hasSettingPass) {
                        if (hasSettingPass) {
                            // Stay on login/setting_pass page (store setup modal)
                            // Keep the modal open, reset form for new entry
                            storeSetupForm.reset();
                            storeSetupLocationDisplay.style.display = 'none';
                            storeLocationData = null;
                            storeSetupModal.classList.add('show'); // Ensure it's visible
                        } else if (nextPage === 'login' || nextPage === 'login/') {
                            // Redirect to login page
                            storeSetupForm.reset();
                            storeSetupLocationDisplay.style.display = 'none';
                            storeLocationData = null;
                            storeSetupModal.classList.remove('show');
                            mainHeader.classList.remove('header-admin-mode');
                            adminDashboard.classList.remove('show');
                            mainContentArea.style.display = 'block';
                            document.querySelector('.search-bar').style.display = 'flex';
                            loginModal.classList.add('show');
                        } else if (nextPage === 'home' || nextPage === 'home/') {
                            // Redirect to home page
                            storeSetupForm.reset();
                            storeSetupLocationDisplay.style.display = 'none';
                            storeLocationData = null;
                            storeSetupModal.classList.remove('show');
                            mainHeader.classList.remove('header-admin-mode');
                            adminDashboard.classList.remove('show');
                            mainContentArea.style.display = 'block';
                            document.querySelector('.search-bar').style.display = 'flex';
                            loginModal.classList.remove('show');
                        } else {
                            // For other nextPage values
                            console.log('nextPage value:', nextPage);
                            // Default: close modal and show home page
                            storeSetupForm.reset();
                            storeSetupLocationDisplay.style.display = 'none';
                            storeLocationData = null;
                            storeSetupModal.classList.remove('show');
                            mainHeader.classList.remove('header-admin-mode');
                            adminDashboard.classList.remove('show');
                            mainContentArea.style.display = 'block';
                            document.querySelector('.search-bar').style.display = 'flex';
                        }
                    } else {
                        // If no nextPage specified, default: close modal and show home
                        storeSetupForm.reset();
                        storeSetupLocationDisplay.style.display = 'none';
                        storeLocationData = null;
                        storeSetupModal.classList.remove('show');
                        mainContentArea.style.display = 'block';
                        document.querySelector('.search-bar').style.display = 'flex';
                    }
                }
            } catch (error) {
                console.error('Store setup error:', error);
                alert('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.');
            } finally {
                storeSetupSubmitBtn.disabled = false;
                storeSetupSubmitBtn.textContent = 'Ø§Ø±Ø³Ø§Ù„';
            }
        });

        // Close modals when clicking outside
        contactModal.addEventListener('click', function(e) {
            if (e.target === contactModal) {
                contactModal.classList.remove('show');
            }
        });

        loginModal.addEventListener('click', function(e) {
            if (e.target === loginModal) {
                loginModal.classList.remove('show');
            }
        });

        passwordResetModal.addEventListener('click', function(e) {
            if (e.target === passwordResetModal) {
                passwordResetModal.classList.remove('show');
            }
        });

        storeSetupModal.addEventListener('click', function(e) {
            if (e.target === storeSetupModal) {
                storeSetupModal.classList.remove('show');
            }
        });

        goldPriceModal.addEventListener('click', function(e) {
            if (e.target === goldPriceModal) {
                goldPriceModal.classList.remove('show');
            }
        });

        // Admin Dashboard Button Handlers
        headerSupportBtn.addEventListener('click', function() {
            supportModal.classList.add('show');
        });

        headerProductsBtn.addEventListener('click', async function() {
            // 10 Ù…Ø­ØµÙˆÙ„ Ø¢Ø®Ø± - trigger webhook and display images
            if (!requireAuth()) return;
            
            try {
                const token = getToken();
                const username = getUsername();
                
                if (!token) {
                    alert('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯');
                    return;
                }
                
                // Show loading state
                clearEmptyState();
                const loadingMessage = appendMessage('bot', 'Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª...', { isPending: true });
                
                const response = await fetch('https://33140-nwo6p.s1.irann8n.com/webhook-test/0bb445e1-3e17-4af3-b6f5-668723e9a53c', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'last_products',
                        token: token,
                        username: username,
                        timestamp: new Date().toISOString()
                    })
                });
                
                // Remove loading message
                if (loadingMessage) {
                    loadingMessage.remove();
                }
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    if (errorData.message && (errorData.message.includes('token') || errorData.message.includes('unauthorized'))) {
                        clearToken();
                        requireAuth();
                        return;
                    }
                    throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª');
                }
                
                const data = await response.json();
                
                // Display images with captions
                if (data && Array.isArray(data) && data.length > 0) {
                    // If response is an array of images
                    data.forEach(item => {
                        const imageUrl = item.url || item.image || item.image_url || item.photo || item.src;
                        const caption = item.caption || item.title || item.name || item.description || '';
                        
                        if (imageUrl) {
                            const imageContent = createImageContent({ url: imageUrl, caption: caption });
                            appendMessage('bot', imageContent);
                        }
                    });
                } else if (data.items && Array.isArray(data.items)) {
                    // If response has items array
                    data.items.forEach(item => {
                        const imageUrl = item.url || item.image || item.image_url || item.photo || item.src;
                        const caption = item.caption || item.title || item.name || item.description || '';
                        
                        if (imageUrl) {
                            const imageContent = createImageContent({ url: imageUrl, caption: caption });
                            appendMessage('bot', imageContent);
                        }
                    });
                } else if (data.images && Array.isArray(data.images)) {
                    // If response has images array
                    data.images.forEach(item => {
                        const imageUrl = item.url || item.image || item.image_url || item.photo || item.src;
                        const caption = item.caption || item.title || item.name || item.description || '';
                        
                        if (imageUrl) {
                            const imageContent = createImageContent({ url: imageUrl, caption: caption });
                            appendMessage('bot', imageContent);
                        }
                    });
                } else if (data.url || data.image || data.image_url || data.photo) {
                    // Single image response
                    const imageUrl = data.url || data.image || data.image_url || data.photo;
                    const caption = data.caption || data.title || data.name || data.description || '';
                    const imageContent = createImageContent({ url: imageUrl, caption: caption });
                    appendMessage('bot', imageContent);
                } else {
                    // No images found
                    appendMessage('bot', 'Ù…Ø­ØµÙˆÙ„ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.');
                }
                
                // Ensure main content area is visible
                mainContentArea.style.display = 'block';
                
            } catch (error) {
                console.error('Last products error:', error);
                appendMessage('bot', 'Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.');
            }
        });

        updatePricesBtn.addEventListener('click', async function() {
            // Ø¢Ù¾Ø¯ÛŒØª Ù‚ÛŒÙ…Øª Ù‡Ø§ - trigger webhook
            if (!requireAuth()) return;
            
            try {
                const token = getToken();
                const username = getUsername();
                
                if (!token) {
                    alert('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯');
                    return;
                }
                
                const response = await fetch('https://33140-nwo6p.s1.irann8n.com/webhook-test/5906c811-a199-49c6-bd96-1f2e1cdf6e53', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'update_prices',
                        token: token,
                        username: username,
                        timestamp: new Date().toISOString()
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    if (errorData.message && (errorData.message.includes('token') || errorData.message.includes('unauthorized'))) {
                        clearToken();
                        requireAuth();
                        return;
                    }
                    throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§');
                }
                
                const data = await response.json();
                if (response.ok) {
                    // Check nextPage value from response
                    if (data.nextPage) {
                        if (data.nextPage === 'login') {
                            // Redirect to login page
                            clearToken();
                            mainHeader.classList.remove('header-admin-mode');
                            adminDashboard.classList.remove('show');
                            mainContentArea.style.display = 'block';
                            document.querySelector('.search-bar').style.display = 'flex';
                            loginModal.classList.add('show');
                            alert('Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯');
                        } else if (data.nextPage === 'home') {
                            // Stay on home page (already there)
                            alert('Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯Ù†Ø¯');
                        }
                    } else {
                        // No nextPage specified, show success message
                        alert('Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯Ù†Ø¯');
                    }
                }
            } catch (error) {
                console.error('Update prices error:', error);
                alert('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§');
            }
        });

        deleteEditBtn.addEventListener('click', async function() {
            // Ø­Ø°Ù ÛŒØ§ Ø§Ø¯ÛŒØª - trigger webhook and check response
            if (!requireAuth()) return;
            
            try {
                const token = getToken();
                const username = getUsername();
                
                if (!token) {
                    alert('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯');
                    return;
                }
                
                const response = await fetch(PAGE_NAVIGATION_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'delete_edit',
                        token: token,
                        username: username,
                        timestamp: new Date().toISOString()
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    if (errorData.message && (errorData.message.includes('token') || errorData.message.includes('unauthorized'))) {
                        clearToken();
                        requireAuth();
                        return;
                    }
                    throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±');
                }
                
                const data = await response.json();
                const nextpage = data.nextpage || data.nextPage || '';
                
                if (nextpage === 'admin/delete_edit') {
                    adminDashboard.classList.remove('show');
                    deleteEditPage.classList.add('show');
                    deleteEditPage.style.display = 'block';
                    backBtn.style.display = 'flex';
                } else if (nextpage === 'login') {
                    clearToken();
                    requireAuth();
                } else if (nextpage === 'Home') {
                    adminDashboard.classList.remove('show');
                    mainHeader.classList.remove('header-admin-mode');
                    mainContentArea.style.display = 'block';
                    document.querySelector('.search-bar').style.display = 'flex';
                }
            } catch (error) {
                console.error('Delete/Edit error:', error);
                alert('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±');
            }
        });

        addBtn.addEventListener('click', async function() {
            // Ø§ÙØ²ÙˆØ¯Ù† - trigger webhook and check response
            if (!requireAuth()) return;
            
            try {
                const token = getToken();
                const username = getUsername();
                
                if (!token) {
                    alert('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯');
                    return;
                }
                
                const response = await fetch(PAGE_NAVIGATION_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'add',
                        token: token,
                        username: username,
                        timestamp: new Date().toISOString()
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    if (errorData.message && (errorData.message.includes('token') || errorData.message.includes('unauthorized'))) {
                        clearToken();
                        requireAuth();
                        return;
                    }
                    throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±');
                }
                
                const data = await response.json();
                const nextpage = data.nextpage || data.nextPage || '';
                
                if (nextpage === 'admin/add') {
                    adminDashboard.classList.remove('show');
                    addPage.classList.add('show');
                    addPage.style.display = 'block';
                    backBtn.style.display = 'flex';
                    
                    // Fill the form with data from response
                    const goldCodeInput = document.getElementById('goldCode');
                    const productDescriptionInput = document.getElementById('productDescription');
                    
                    if (goldCodeInput && data.code) {
                        goldCodeInput.value = data.code;
                    }
                    if (productDescriptionInput && data.text) {
                        productDescriptionInput.value = data.text;
                    }
                    
                    // Fill the image if provided
                    if (data.image || data.image_url || data.url || data.photo) {
                        const imageUrl = data.image || data.image_url || data.url || data.photo;
                        if (imagePreview) {
                            const img = document.createElement('img');
                            img.src = imageUrl;
                            img.alt = 'Preview';
                            imagePreview.innerHTML = '';
                            imagePreview.appendChild(img);
                        }
                    }
                } else if (nextpage === 'login') {
                    clearToken();
                    requireAuth();
                } else if (nextpage === 'home' || nextpage === 'Home') {
                    adminDashboard.classList.remove('show');
                    mainHeader.classList.remove('header-admin-mode');
                    mainContentArea.style.display = 'block';
                    document.querySelector('.search-bar').style.display = 'flex';
                    backBtn.style.display = 'none';
                }
            } catch (error) {
                console.error('Add error:', error);
                alert('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±');
            }
        });

        // Support form submission
        supportForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!requireAuth()) return;
            
            const text = document.getElementById('supportText').value.trim();
            const number = document.getElementById('supportNumber').value.trim();

            if (!text || !number) {
                alert('Ù„Ø·ÙØ§Ù‹ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯');
                return;
            }

            supportSubmitBtn.disabled = true;
            supportSubmitBtn.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„...';

            try {
                const token = getToken();
                const username = getUsername();
                
                if (!token) {
                    alert('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯');
                    supportSubmitBtn.disabled = false;
                    supportSubmitBtn.textContent = 'Ø§Ø±Ø³Ø§Ù„';
                    return;
                }
                
                const response = await fetch(ADMIN_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'support',
                        token: token,
                        username: username,
                        text: text,
                        number: number,
                        timestamp: new Date().toISOString()
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    if (errorData.message && (errorData.message.includes('token') || errorData.message.includes('unauthorized'))) {
                        clearToken();
                        requireAuth();
                        return;
                    }
                    throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…');
                }

                const data = await response.json();
                if (response.ok) {
                    alert('Ù¾ÛŒØ§Ù… Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯');
                    supportForm.reset();
                    supportModal.classList.remove('show');
                }
            } catch (error) {
                console.error('Support form error:', error);
                alert('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.');
            } finally {
                supportSubmitBtn.disabled = false;
                supportSubmitBtn.textContent = 'Ø§Ø±Ø³Ø§Ù„';
            }
        });

        // Close support modal
        closeSupportModalBtn.addEventListener('click', function() {
            supportModal.classList.remove('show');
        });

        supportModal.addEventListener('click', function(e) {
            if (e.target === supportModal) {
                supportModal.classList.remove('show');
            }
        });

        // Close colored pages
        closeGreenPageBtn.addEventListener('click', function() {
            greenPage.classList.remove('show');
        });

        closeRedPageBtn.addEventListener('click', function() {
            redPage.classList.remove('show');
        });

        // Image upload preview functionality
        if (imagePreview && imageInput) {
            // Click on preview area to trigger file input
            imagePreview.addEventListener('click', function() {
                imageInput.click();
            });

            // Handle file selection
            imageInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        imagePreview.innerHTML = `<img src="${e.target.result}" alt="Preview" />`;
                    };
                    reader.readAsDataURL(file);
                } else {
                    imagePreview.innerHTML = `
                        <div class="image-upload-placeholder">
                            <span class="upload-icon">ğŸ“</span>
                            <span class="upload-text">Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØµÙˆÛŒØ±</span>
                        </div>
                    `;
                }
            });
        }

        // Add form submission
        if (addForm) {
            addForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                if (!requireAuth()) return;
                
                const goldCode = document.getElementById('goldCode').value.trim();
                const productDescription = document.getElementById('productDescription').value.trim();
                const imageFile = imageInput ? imageInput.files[0] : null;

                if (!goldCode || !productDescription) {
                    alert('Ù„Ø·ÙØ§Ù‹ Ú©Ø¯ Ø·Ù„Ø§ Ùˆ ØªÙˆØ¶ÛŒØ­Ø§Øª Ù…Ø­ØµÙˆÙ„ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                    return;
                }

                addSubmitBtn.disabled = true;
                addSubmitBtn.innerHTML = '<span class="send-icon">â³</span>';

                try {
                    const token = getToken();
                    const username = getUsername();
                    
                    if (!token) {
                        alert('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯');
                        addSubmitBtn.disabled = false;
                        addSubmitBtn.innerHTML = '<span class="send-icon">â†‘</span>';
                        return;
                    }
                    
                    // Convert image to base64 if present
                    let imageBase64 = null;
                    if (imageFile) {
                        imageBase64 = await new Promise((resolve, reject) => {
                            const reader = new FileReader();
                            reader.onload = () => resolve(reader.result);
                            reader.onerror = reject;
                            reader.readAsDataURL(imageFile);
                        });
                    }

                    const response = await fetch(ADMIN_WEBHOOK_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            action: 'add_product',
                            token: token,
                            username: username,
                            goldCode: goldCode,
                            productDescription: productDescription,
                            image: imageBase64,
                            timestamp: new Date().toISOString()
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        if (errorData.message && (errorData.message.includes('token') || errorData.message.includes('unauthorized'))) {
                            clearToken();
                            requireAuth();
                            return;
                        }
                        throw new Error(errorData.message || 'Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª');
                    }

                    const data = await response.json();
                    if (response.ok) {
                        // Show message from backend if available
                        const message = data.message || '';
                        if (message) {
                            alert(message);
                        }
                        
                        addForm.reset();
                        if (imagePreview) {
                            imagePreview.innerHTML = `
                                <div class="image-upload-placeholder">
                                    <span class="upload-icon">ğŸ“</span>
                                    <span class="upload-text">Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØµÙˆÛŒØ±</span>
                                </div>
                            `;
                        }
                        
                        // Check for nextpage in response
                        const nextpage = data.nextpage || data.nextPage || '';
                        
                        if (nextpage === 'admin/add') {
                            // Stay on add page - don't navigate away
                            // Form is already reset above, user can add more items
                        } else if (nextpage === 'login') {
                            clearToken();
                            requireAuth();
                            addPage.classList.remove('show');
                            addPage.style.display = 'none';
                        } else if (nextpage === 'Home' || nextpage === 'home') {
                            addPage.classList.remove('show');
                            addPage.style.display = 'none';
                            adminDashboard.classList.remove('show');
                            mainHeader.classList.remove('header-admin-mode');
                            mainContentArea.style.display = 'block';
                            document.querySelector('.search-bar').style.display = 'flex';
                        } else {
                            // Default: go back to admin dashboard
                            addPage.classList.remove('show');
                            addPage.style.display = 'none';
                            adminDashboard.classList.add('show');
                        }
                    }
                } catch (error) {
                    console.error('Add form error:', error);
                    alert('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.');
                } finally {
                    addSubmitBtn.disabled = false;
                    addSubmitBtn.innerHTML = '<span class="send-icon">â†‘</span>';
                }
            });
        }

        // Add page back button handler
        if (addPageBackBtn) {
            addPageBackBtn.addEventListener('click', function() {
                addPage.classList.remove('show');
                addPage.style.display = 'none';
                adminDashboard.classList.add('show');
                backBtn.style.display = 'none';
            });
        }

        // Delete/Edit page back button handler
        if (deleteEditPageBackBtn) {
            deleteEditPageBackBtn.addEventListener('click', function() {
                // Reset state
                if (deleteEditResults) {
                    deleteEditResults.style.display = 'none';
                    deleteEditResults.innerHTML = '';
                }
                if (deleteEditActions) {
                    deleteEditActions.style.display = 'none';
                }
                if (deleteEditInput) {
                    deleteEditInput.value = '';
                }
                selectedImageData = null;
                
                deleteEditPage.classList.remove('show');
                deleteEditPage.style.display = 'none';
                adminDashboard.classList.add('show');
                backBtn.style.display = 'none';
            });
        }

        // Delete/Edit form submission
        let selectedImageData = null;

        function displayDeleteEditResults(data) {
            deleteEditResults.innerHTML = '';
            deleteEditResults.style.display = 'block';
            selectedImageData = null;
            deleteEditActions.style.display = 'none';
            deleteActionBtn.disabled = true;
            editActionBtn.disabled = true;

            // Parse response - handle different response formats
            let images = [];
            
            if (Array.isArray(data)) {
                images = data;
            } else if (data.images && Array.isArray(data.images)) {
                images = data.images;
            } else if (data.items && Array.isArray(data.items)) {
                images = data.items;
            } else if (data.results && Array.isArray(data.results)) {
                images = data.results;
            } else if (data.url || data.image) {
                // Single image
                images = [{
                    url: data.url || data.image || data.image_url || data.photo,
                    caption: data.caption || data.description || data.text || ''
                }];
            } else if (typeof data === 'object') {
                // Try to extract image from object
                const url = data.url || data.image || data.image_url || data.photo;
                if (url) {
                    images = [{
                        url: url,
                        caption: data.caption || data.description || data.text || data.info || ''
                    }];
                }
            }

            if (images.length === 0) {
                deleteEditResults.innerHTML = '<div class="delete-edit-empty">Ù†ØªÛŒØ¬Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</div>';
                return;
            }

            images.forEach((imageData, index) => {
                const imageItem = document.createElement('div');
                imageItem.className = 'delete-edit-image-item';
                imageItem.dataset.index = index;
                
                const img = document.createElement('img');
                img.src = imageData.url || imageData.image || imageData.image_url || imageData.photo;
                img.alt = imageData.caption || imageData.description || imageData.text || '';
                img.onerror = function() {
                    this.style.display = 'none';
                };
                
                const caption = document.createElement('div');
                caption.className = 'delete-edit-image-caption';
                caption.textContent = imageData.caption || imageData.description || imageData.text || imageData.info || '';
                
                imageItem.appendChild(img);
                imageItem.appendChild(caption);
                
                imageItem.addEventListener('click', function() {
                    // Remove previous selection
                    document.querySelectorAll('.delete-edit-image-item').forEach(item => {
                        item.classList.remove('selected');
                    });
                    
                    // Add selection to clicked item
                    this.classList.add('selected');
                    selectedImageData = {
                        url: imageData.url || imageData.image || imageData.image_url || imageData.photo,
                        caption: imageData.caption || imageData.description || imageData.text || imageData.info || '',
                        index: index,
                        originalData: imageData
                    };
                    
                    // Enable action buttons
                    deleteActionBtn.disabled = false;
                    editActionBtn.disabled = false;
                    deleteEditActions.style.display = 'flex';
                });
                
                deleteEditResults.appendChild(imageItem);
            });

            // Scroll to results
            deleteEditResults.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        if (deleteEditForm) {
            deleteEditForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                if (!requireAuth()) return;
                
                const inputValue = deleteEditInput.value.trim();

                if (!inputValue) {
                    alert('Ù„Ø·ÙØ§Ù‹ Ú©Ø¯ Ø·Ù„Ø§ ÛŒØ§ ØªÙˆØ¶ÛŒØ­Ø§Øª Ù…Ø­ØµÙˆÙ„ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                    return;
                }

                deleteEditSubmitBtn.disabled = true;
                deleteEditSubmitBtn.innerHTML = '<span class="send-icon">â³</span>';
                deleteEditResults.style.display = 'block';
                deleteEditResults.innerHTML = '<div class="delete-edit-loading">Ø¯Ø± Ø­Ø§Ù„ Ø¬Ø³ØªØ¬Ùˆ...</div>';
                deleteEditActions.style.display = 'none';

                try {
                    const token = getToken();
                    const username = getUsername();
                    
                    if (!token) {
                        alert('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯');
                        deleteEditSubmitBtn.disabled = false;
                        deleteEditSubmitBtn.innerHTML = '<span class="send-icon">â†‘</span>';
                        return;
                    }
                    
                    const response = await fetch(ADMIN_WEBHOOK_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            action: 'delete_edit_search',
                            token: token,
                            username: username,
                            searchQuery: inputValue,
                            timestamp: new Date().toISOString()
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        if (errorData.message && (errorData.message.includes('token') || errorData.message.includes('unauthorized'))) {
                            clearToken();
                            requireAuth();
                            return;
                        }
                        throw new Error(errorData.message || 'Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª');
                    }

                    const data = await response.json();
                    
                    // Show message from backend if available
                    const message = data.message || '';
                    if (message) {
                        alert(message);
                    }
                    
                    // Check for nextpage in response
                    const nextpage = data.nextpage || data.nextPage || '';
                    if (nextpage) {
                        if (nextpage === 'login') {
                            clearToken();
                            requireAuth();
                            deleteEditPage.classList.remove('show');
                            deleteEditPage.style.display = 'none';
                        } else if (nextpage === 'Home' || nextpage === 'home') {
                            deleteEditPage.classList.remove('show');
                            deleteEditPage.style.display = 'none';
                            adminDashboard.classList.remove('show');
                            mainHeader.classList.remove('header-admin-mode');
                            mainContentArea.style.display = 'block';
                            document.querySelector('.search-bar').style.display = 'flex';
                        } else if (nextpage === 'admin/delete_edit_search') {
                            // Stay on delete/edit page - display results
                            displayDeleteEditResults(data);
                        } else {
                            // Default: go back to admin dashboard
                            deleteEditPage.classList.remove('show');
                            deleteEditPage.style.display = 'none';
                            adminDashboard.classList.add('show');
                        }
                    } else {
                        // No nextPage - display results normally
                        displayDeleteEditResults(data);
                    }
                    
                } catch (error) {
                    console.error('Delete/Edit form error:', error);
                    deleteEditResults.innerHTML = '<div class="delete-edit-empty" style="color: #ff3b30;">Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.</div>';
                    alert('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.');
                } finally {
                    deleteEditSubmitBtn.disabled = false;
                    deleteEditSubmitBtn.innerHTML = '<span class="send-icon">â†‘</span>';
                }
            });
        }

        // Delete action button
        if (deleteActionBtn) {
            deleteActionBtn.addEventListener('click', async function() {
                if (!selectedImageData || !requireAuth()) {
                    alert('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© ØªØµÙˆÛŒØ± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯');
                    return;
                }

                deleteActionBtn.disabled = true;
                editActionBtn.disabled = true;
                deleteActionBtn.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø­Ø°Ù...';

                try {
                    const token = getToken();
                    const username = getUsername();
                    
                    if (!token) {
                        alert('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯');
                        return;
                    }
                    
                    const response = await fetch(ADMIN_WEBHOOK_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            action: 'delete',
                            token: token,
                            username: username,
                            imageUrl: selectedImageData.url,
                            caption: selectedImageData.caption,
                            imageData: selectedImageData.originalData,
                            timestamp: new Date().toISOString()
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        if (errorData.message && (errorData.message.includes('token') || errorData.message.includes('unauthorized'))) {
                            clearToken();
                            requireAuth();
                            return;
                        }
                        throw new Error(errorData.message || 'Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù');
                    }

                    const data = await response.json();
                    alert('Ø¹Ù…Ù„ÛŒØ§Øª Ø­Ø°Ù Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯');
                    
                    // Clear results and reset form
                    deleteEditResults.style.display = 'none';
                    deleteEditResults.innerHTML = '';
                    deleteEditActions.style.display = 'none';
                    deleteEditInput.value = '';
                    selectedImageData = null;
                    
                } catch (error) {
                    console.error('Delete action error:', error);
                    alert('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.');
                } finally {
                    deleteActionBtn.disabled = false;
                    editActionBtn.disabled = false;
                    deleteActionBtn.textContent = 'Ø­Ø°Ù';
                }
            });
        }

        // Edit action button
        if (editActionBtn) {
            editActionBtn.addEventListener('click', async function() {
                if (!selectedImageData || !requireAuth()) {
                    alert('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© ØªØµÙˆÛŒØ± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯');
                    return;
                }

                editActionBtn.disabled = true;
                deleteActionBtn.disabled = true;
                editActionBtn.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¯ÛŒØª...';

                try {
                    const token = getToken();
                    const username = getUsername();
                    
                    if (!token) {
                        alert('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯');
                        return;
                    }
                    
                    const response = await fetch(ADMIN_WEBHOOK_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            action: 'edit',
                            token: token,
                            username: username,
                            imageUrl: selectedImageData.url,
                            caption: selectedImageData.caption,
                            imageData: selectedImageData.originalData,
                            timestamp: new Date().toISOString()
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        if (errorData.message && (errorData.message.includes('token') || errorData.message.includes('unauthorized'))) {
                            clearToken();
                            requireAuth();
                            return;
                        }
                        throw new Error(errorData.message || 'Ø®Ø·Ø§ Ø¯Ø± Ø§Ø¯ÛŒØª');
                    }

                    const data = await response.json();
                    const nextpage = data.nextpage || data.nextPage || '';
                    
                    if (nextpage === 'admin/add') {
                        // Navigate to add page and fill the form
                        deleteEditPage.classList.remove('show');
                        deleteEditPage.style.display = 'none';
                        addPage.classList.add('show');
                        addPage.style.display = 'block';
                        backBtn.style.display = 'flex';
                        
                        // Fill the form with data from response
                        const goldCodeInput = document.getElementById('goldCode');
                        const productDescriptionInput = document.getElementById('productDescription');
                        
                        if (goldCodeInput && data.code) {
                            goldCodeInput.value = data.code;
                        }
                        if (productDescriptionInput && data.text) {
                            productDescriptionInput.value = data.text;
                        }
                        
                        // Fill the image if provided - convert URL to File and set in input
                        if (data.image || data.image_url || data.url || data.photo || selectedImageData?.url) {
                            const imageUrl = data.image || data.image_url || data.url || data.photo || selectedImageData.url;
                            
                            // Show image in preview immediately
                            if (imagePreview) {
                                const img = document.createElement('img');
                                img.src = imageUrl;
                                img.alt = 'Preview';
                                imagePreview.innerHTML = '';
                                imagePreview.appendChild(img);
                            }
                            
                            // Fetch the image and convert to File for the input
                            try {
                                const imageResponse = await fetch(imageUrl);
                                const imageBlob = await imageResponse.blob();
                                
                                // Get file extension from URL or default to jpg
                                const urlParts = imageUrl.split('.');
                                const extension = urlParts.length > 1 ? urlParts[urlParts.length - 1].split('?')[0] : 'jpg';
                                const mimeType = imageBlob.type || `image/${extension === 'png' ? 'png' : 'jpeg'}`;
                                
                                // Create File object
                                const fileName = `edit-image.${extension}`;
                                const imageFile = new File([imageBlob], fileName, { type: mimeType });
                                
                                // Set file in input using DataTransfer
                                const dataTransfer = new DataTransfer();
                                dataTransfer.items.add(imageFile);
                                if (imageInput) {
                                    imageInput.files = dataTransfer.files;
                                }
                            } catch (error) {
                                console.error('Error loading image for edit:', error);
                                // Image preview is already shown, so user can still see it
                            }
                        }
                    } else if (nextpage === 'home' || nextpage === 'Home') {
                        // Go back to home
                        deleteEditPage.classList.remove('show');
                        deleteEditPage.style.display = 'none';
                        adminDashboard.classList.remove('show');
                        mainHeader.classList.remove('header-admin-mode');
                        mainContentArea.style.display = 'block';
                        document.querySelector('.search-bar').style.display = 'flex';
                        backBtn.style.display = 'none';
                    } else {
                        // Default: show success message and clear form
                        alert('Ø¹Ù…Ù„ÛŒØ§Øª Ø§Ø¯ÛŒØª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯');
                        
                        // Clear results and reset form
                        deleteEditResults.style.display = 'none';
                        deleteEditResults.innerHTML = '';
                        deleteEditActions.style.display = 'none';
                        deleteEditInput.value = '';
                        selectedImageData = null;
                    }
                    
                } catch (error) {
                    console.error('Edit action error:', error);
                    alert('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø¯ÛŒØª. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.');
                } finally {
                    editActionBtn.disabled = false;
                    deleteActionBtn.disabled = false;
                    editActionBtn.textContent = 'Ø§Ø¯ÛŒØª';
                }
            });
        }
    </script>
</body>
</html>
