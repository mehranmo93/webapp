<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Marketplace Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            direction: rtl;
            overflow-x: hidden;
            padding-bottom: 80px;
            padding-top: 80px;
        }

        /* Header Styles */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background-color: #ffffff;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            padding: 12px 16px;
        }

        .header-content {
            display: flex;
            align-items: center;
            gap: 12px;
            justify-content: space-between;
        }

        .header-admin-mode .store-selector,
        .header-admin-mode .address-btn,
        .header-admin-mode .menu-btn {
            display: none;
        }

        .header-admin-buttons {
            display: none;
            gap: 12px;
            flex: 1;
        }

        .header-admin-mode .header-admin-buttons {
            display: flex;
        }

        .header-admin-mode .back-btn {
            display: flex !important;
        }

        .header-admin-btn {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: transform 0.2s, opacity 0.2s, background-color 0.2s;
            text-align: center;
            min-height: 52px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header-admin-btn:active {
            transform: scale(0.98);
        }

        .header-admin-btn-support {
            background-color: #0088cc;
            color: white;
        }

        .header-admin-btn-support:hover {
            background-color: #0077b3;
        }

        .header-admin-btn-products {
            background-color: #666;
            color: white;
        }

        .header-admin-btn-products:hover {
            background-color: #555;
        }

        .store-selector {
            flex: 1;
            position: relative;
        }

        .store-selector-btn {
            width: 100%;
            padding: 10px 16px;
            background-color: #0088cc;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            text-align: right;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background-color 0.2s;
        }

        .store-selector-btn:hover {
            background-color: #0077b3;
        }

        .store-selector-btn::after {
            content: '‚ñº';
            font-size: 10px;
            margin-right: 8px;
        }

        .store-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            left: 0;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            margin-top: 4px;
            display: none;
            z-index: 1001;
            max-height: 200px;
            overflow-y: auto;
        }

        .store-dropdown.show {
            display: block;
        }

        .store-option {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s;
        }

        .store-option:last-child {
            border-bottom: none;
        }

        .store-option:hover {
            background-color: #f5f5f5;
        }

        .address-btn {
            padding: 10px 20px;
            background-color: #34c759;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            transition: background-color 0.2s;
        }

        .address-btn:hover {
            background-color: #30b050;
        }

        .menu-btn {
            padding: 10px 16px;
            background-color: #666;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .menu-btn:hover {
            background-color: #555;
        }

        .menu-btn::before {
            content: '‚ò∞';
            font-size: 18px;
        }

        .back-btn {
            padding: 10px 16px;
            background-color: #666;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
        }

        .back-btn:hover {
            background-color: #555;
        }

        .back-btn::before {
            content: '‚Üê';
            font-size: 20px;
        }

        .accordion-menu {
            position: fixed;
            top: 60px;
            right: 16px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: none;
            z-index: 1002;
            min-width: 200px;
            overflow: hidden;
        }

        .accordion-menu.show {
            display: block;
        }

        .accordion-item {
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .accordion-item:last-child {
            border-bottom: none;
        }

        .accordion-item:hover {
            background-color: #f5f5f5;
        }

        .accordion-item-content {
            padding: 14px 16px;
            font-size: 14px;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .accordion-item-content::after {
            content: '‚Ä∫';
            font-size: 18px;
            color: #999;
        }

        /* Content Area */
        .content-area {
            padding: 16px;
            min-height: calc(100vh - 160px);
        }

        .search-results {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .chat-thread {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .message {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 16px;
            font-size: 14px;
            line-height: 1.6;
            position: relative;
            word-break: break-word;
        }

        .message-user {
            align-self: flex-end;
            background-color: #0088cc;
            color: #fff;
            border-bottom-right-radius: 4px;
        }

        .message-bot {
            align-self: flex-start;
            background-color: #f0f0f0;
            color: #222;
            border-bottom-left-radius: 4px;
        }

        .message-text {
            white-space: pre-wrap;
        }

        .message-media {
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .message-media img {
            width: 100%;
            border-radius: 12px;
            object-fit: cover;
        }

        .message-media figcaption {
            font-size: 13px;
            color: #333;
            padding: 8px 0 0 0;
            line-height: 1.5;
            text-align: right;
        }

        .message-location {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .message-location a {
            color: #0088cc;
            text-decoration: none;
            font-weight: 600;
        }

        .message-location a:hover {
            text-decoration: underline;
        }

        .location-coords {
            font-size: 12px;
            color: #666;
        }

        .message-status {
            font-size: 12px;
            color: #999;
            margin-top: 4px;
            text-align: left;
        }

        .typing-dots::after {
            content: '‚Ä¶';
            animation: blink 1.2s infinite;
        }

        @keyframes blink {
            0% { opacity: 0.2; }
            50% { opacity: 1; }
            100% { opacity: 0.2; }
        }

        .result-item {
            background-color: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-image {
            width: 100%;
            height: 200px;
            background-color: #4caf50;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
        }

        .result-text {
            padding: 12px 16px;
            font-size: 14px;
            color: #333;
            line-height: 1.6;
        }

        .result-text-only {
            padding: 16px;
            font-size: 14px;
            color: #333;
            line-height: 1.6;
        }

        /* Search Bar */
        .search-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #ffffff;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);
            padding: 12px 16px;
            z-index: 1000;
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .search-input {
            flex: 1;
            padding: 10px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 24px;
            font-size: 14px;
            direction: rtl;
            outline: none;
            transition: border-color 0.2s;
        }

        .search-input:focus {
            border-color: #0088cc;
        }

        .search-btn {
            width: 44px;
            height: 44px;
            background-color: #0088cc;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: background-color 0.2s;
            flex-shrink: 0;
        }

        .search-btn:hover {
            background-color: #0077b3;
        }

        .search-btn:active {
            transform: scale(0.95);
        }

        .search-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background-color: white;
            border-radius: 16px;
            padding: 24px;
            max-width: 400px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #333;
        }

        .modal-body {
            margin-bottom: 20px;
            color: #666;
            line-height: 1.6;
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .modal-btn-primary {
            background-color: #0088cc;
            color: white;
        }

        .modal-btn-primary:hover {
            background-color: #0077b3;
        }

        .modal-btn-secondary {
            background-color: #e0e0e0;
            color: #333;
        }

        .modal-btn-secondary:hover {
            background-color: #d0d0d0;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 6px;
            font-size: 14px;
            font-weight: 500;
            color: #333;
        }

        .form-input {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            direction: rtl;
            outline: none;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            border-color: #0088cc;
        }

        .form-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            direction: rtl;
            outline: none;
            resize: vertical;
            min-height: 100px;
            transition: border-color 0.2s;
            font-family: inherit;
        }

        .form-textarea:focus {
            border-color: #0088cc;
        }

        .form-submit-btn {
            width: 100%;
            padding: 12px;
            background-color: #0088cc;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .form-submit-btn:hover {
            background-color: #0077b3;
        }

        .form-submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .gold-price-container {
            padding: 16px 0;
        }

        .gold-price-item {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
        }

        .gold-price-item:last-child {
            border-bottom: none;
        }

        .gold-price-label {
            font-weight: 500;
            color: #333;
        }

        .gold-price-value {
            color: #0088cc;
            font-weight: 600;
        }

        /* Admin Dashboard */
        .admin-dashboard {
            display: none;
            padding: 16px;
            padding-bottom: 180px;
            min-height: calc(100vh - 160px);
            flex-direction: column;
            position: relative;
        }

        .admin-dashboard.show {
            display: flex;
        }

        .admin-buttons-top {
            display: none;
        }

        .admin-buttons-bottom {
            display: flex;
            flex-direction: column;
            gap: 12px;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 16px;
            background-color: #f5f5f5;
            z-index: 100;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);
        }

        .admin-buttons-row {
            display: flex;
            gap: 12px;
        }

        .admin-buttons-row .admin-btn {
            flex: 1;
        }

        .admin-btn {
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: transform 0.2s, opacity 0.2s, background-color 0.2s;
            text-align: center;
            min-height: 52px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .admin-btn:active {
            transform: scale(0.98);
        }

        .admin-btn-support {
            background-color: #0088cc;
            color: white;
        }

        .admin-btn-support:hover {
            background-color: #0077b3;
        }

        .admin-btn-products {
            background-color: #666;
            color: white;
        }

        .admin-btn-products:hover {
            background-color: #555;
        }

        .admin-btn-update {
            background-color: #34c759;
            color: white;
        }

        .admin-btn-update:hover {
            background-color: #30b050;
        }

        .admin-btn-delete {
            background-color: #ff3b30;
            color: white;
        }

        .admin-btn-delete:hover {
            background-color: #e6342a;
        }

        .admin-btn-add {
            background-color: #0a84ff;
            color: white;
        }

        .admin-btn-add:hover {
            background-color: #0071e3;
        }

        /* Admin Pages */
        .admin-page {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #f5f5f5;
            z-index: 2000;
            padding: 80px 16px 16px 16px;
            overflow-y: auto;
        }

        .admin-page.show {
            display: block;
        }

        .admin-page-content {
            background-color: white;
            border: 2px solid #0088cc;
            border-radius: 16px;
            padding: 24px;
            padding-left: 72px;
            max-width: 500px;
            margin: 0 auto;
            position: relative;
        }

        .admin-page-back-btn {
            position: absolute;
            top: 16px;
            left: 16px;
            width: 44px;
            height: 44px;
            background-color: #666;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 24px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s, transform 0.2s;
            z-index: 10;
        }

        .admin-page-back-btn:hover {
            background-color: #555;
        }

        .admin-page-back-btn:active {
            transform: scale(0.95);
        }

        #deleteEditPage .admin-page-content {
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            min-height: calc(100vh - 160px);
            padding-bottom: 40px;
        }

        .delete-edit-bottom-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
        }

        .delete-edit-label {
            font-size: 14px;
            font-weight: 500;
            color: #333;
            margin-bottom: 4px;
        }

        .delete-edit-form {
            display: flex;
            flex-direction: row-reverse;
            gap: 8px;
            align-items: center;
            width: 100%;
        }

        .delete-edit-input {
            flex: 1;
            padding: 10px 16px;
            border: 2px solid #0088cc;
            border-radius: 24px;
            font-size: 14px;
            direction: rtl;
            outline: none;
            transition: border-color 0.2s;
            font-family: inherit;
            box-sizing: border-box;
        }

        .delete-edit-input:focus {
            border-color: #0077b3;
        }

        .delete-edit-send-btn {
            width: 44px;
            height: 44px;
            background-color: #0088cc;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 20px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s, transform 0.2s;
            flex-shrink: 0;
        }

        .delete-edit-send-btn:hover {
            background-color: #0077b3;
        }

        .delete-edit-send-btn:active {
            transform: scale(0.95);
        }

        .delete-edit-send-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .admin-form-group {
            margin-bottom: 20px;
        }

        .admin-form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
            color: #333;
        }

        .admin-form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #0088cc;
            border-radius: 8px;
            font-size: 14px;
            direction: rtl;
            outline: none;
            transition: border-color 0.2s;
            font-family: inherit;
            box-sizing: border-box;
        }

        .admin-form-input:focus {
            border-color: #0077b3;
        }

        .image-upload-area {
            margin-top: 8px;
        }

        .image-upload-area input[type="file"] {
            display: none;
        }

        .image-preview {
            margin-top: 12px;
            width: 100%;
            min-height: 200px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            background-color: #fafafa;
        }

        .image-preview:hover {
            border-color: #0088cc;
        }

        .image-upload-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            color: #666;
        }

        .upload-icon {
            font-size: 48px;
        }

        .upload-text {
            font-size: 14px;
        }

        .image-preview img {
            max-width: 100%;
            max-height: 400px;
            border-radius: 8px;
            object-fit: contain;
        }

        .admin-send-btn {
            width: 60px;
            height: 60px;
            background-color: #0088cc;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px auto 0;
            box-shadow: 0 2px 8px rgba(0, 136, 204, 0.3);
        }

        .admin-send-btn:hover {
            background-color: #0077b3;
            transform: scale(1.05);
        }

        .admin-send-btn:active {
            transform: scale(0.95);
        }

        .admin-send-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .send-icon {
            font-size: 24px;
            line-height: 1;
        }

        /* Colored Pages */
        .colored-page {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 3000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .colored-page.show {
            display: flex;
        }

        .colored-page.green {
            background-color: #34c759;
        }

        .colored-page.red {
            background-color: #ff3b30;
        }

        .colored-page-content {
            background-color: white;
            border-radius: 16px;
            padding: 24px;
            max-width: 400px;
            width: 100%;
            text-align: center;
        }

        .colored-page-content h2 {
            margin-bottom: 16px;
            color: #333;
        }

        .colored-page-close {
            margin-top: 16px;
            padding: 10px 20px;
            background-color: #0088cc;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }

        .colored-page-close:hover {
            background-color: #0077b3;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 20px;
            color: #999;
        }

        /* Responsive adjustments */
        @media (max-width: 480px) {
            .header {
                padding: 10px 12px;
            }

            .content-area {
                padding: 12px;
            }

            .search-bar {
                padding: 10px 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header" id="mainHeader">
        <div class="header-content">
            <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                <div class="store-selector">
                    <button class="store-selector-btn" id="storeSelectorBtn">
                        ÿ¨ŸàÿßŸáÿ±€å ÿ≥ÿ™ÿßÿ±ÿ≤ÿßÿØŸá
                    </button>
                    <div class="store-dropdown" id="storeDropdown">
                        <div class="store-option" data-store="ÿ¨ŸàÿßŸáÿ±€å ÿ≥ÿ™ÿßÿ±ÿ≤ÿßÿØŸá">ÿ¨ŸàÿßŸáÿ±€å ÿ≥ÿ™ÿßÿ±ÿ≤ÿßÿØŸá</div>
                        <div class="store-option" data-store="ŸÅÿ±Ÿàÿ¥⁄ØÿßŸá €±">ŸÅÿ±Ÿàÿ¥⁄ØÿßŸá €±</div>
                        <div class="store-option" data-store="ŸÅÿ±Ÿàÿ¥⁄ØÿßŸá €≤">ŸÅÿ±Ÿàÿ¥⁄ØÿßŸá €≤</div>
                    </div>
                </div>
                <button class="address-btn" id="addressBtn">ÿ¢ÿØÿ±ÿ≥</button>
            </div>
            <div class="header-admin-buttons">
                <button class="header-admin-btn header-admin-btn-products" id="headerProductsBtn">10 ŸÖÿ≠ÿµŸàŸÑ ÿ¢ÿÆÿ±</button>
                <button class="header-admin-btn header-admin-btn-support" id="headerSupportBtn">Ÿæÿ¥ÿ™€åÿ®ÿßŸÜ€å</button>
            </div>
            <button class="menu-btn" id="menuBtn"></button>
            <button class="back-btn" id="backBtn" style="display: none;"></button>
        </div>
    </div>

    <!-- Accordion Menu -->
    <div class="accordion-menu" id="accordionMenu">
        <div class="accordion-item" id="contactMenuItem">
            <div class="accordion-item-content">ÿßÿ±ÿ™ÿ®ÿßÿ∑ ÿ®ÿß ŸÖÿß</div>
        </div>
        <div class="accordion-item" id="loginMenuItem">
            <div class="accordion-item-content">Ÿàÿ±ŸàÿØ</div>
        </div>
    </div>

    <!-- Content Area -->
    <div class="content-area" id="mainContentArea">
        <div class="search-results chat-thread" id="searchResults">
            <div class="empty-state">
                <div class="empty-state-icon">üîç</div>
                <div>ÿ®ÿ±ÿß€å ÿ¨ÿ≥ÿ™ÿ¨Ÿàÿå ŸÖÿ™ŸÜ ÿÆŸàÿØ ÿ±ÿß ÿØÿ± ⁄©ÿßÿØÿ± Ÿæÿß€å€åŸÜ Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ</div>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div class="admin-dashboard" id="adminDashboard">
        <div class="admin-buttons-top"></div>
        <div class="admin-buttons-bottom">
            <button class="admin-btn admin-btn-update" id="updatePricesBtn">ÿ¢ŸæÿØ€åÿ™ ŸÇ€åŸÖÿ™ Ÿáÿß</button>
            <div class="admin-buttons-row">
                <button class="admin-btn admin-btn-add" id="addBtn">ÿßÿ∂ÿßŸÅŸá</button>
                <button class="admin-btn admin-btn-delete" id="deleteEditBtn">ÿ≠ÿ∞ŸÅ €åÿß ÿßÿØ€åÿ™</button>
            </div>
        </div>
    </div>

    <!-- Search Bar -->
    <div class="search-bar">
        <input type="text" class="search-input" id="searchInput" placeholder="Text box" />
        <button class="search-btn" id="searchBtn">‚Üë</button>
    </div>

    <!-- Address Modal -->
    <div class="modal" id="addressModal">
        <div class="modal-content">
            <div class="modal-header">ÿ¢ÿØÿ±ÿ≥ ŸÅÿ±Ÿàÿ¥⁄ØÿßŸá</div>
            <div class="modal-body" id="modalAddress">
                ÿØÿ± ÿ≠ÿßŸÑ ÿ®ÿßÿ±⁄Øÿ∞ÿßÿ±€å...
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" id="closeModalBtn">ÿ®ÿ≥ÿ™ŸÜ</button>
                <button class="modal-btn modal-btn-primary" id="viewMapBtn">ŸÖÿ¥ÿßŸáÿØŸá ÿ±Ÿà€å ŸÜŸÇÿ¥Ÿá</button>
            </div>
        </div>
    </div>

    <!-- Contact Us Modal -->
    <div class="modal" id="contactModal">
        <div class="modal-content">
            <div class="modal-header">ÿßÿ±ÿ™ÿ®ÿßÿ∑ ÿ®ÿß ŸÖÿß</div>
            <div class="modal-body">
                <form id="contactForm">
                    <div class="form-group">
                        <label class="form-label" for="contactName">ŸÜÿßŸÖ</label>
                        <input type="text" class="form-input" id="contactName" required />
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="contactPhone">ÿ¥ŸÖÿßÿ±Ÿá ÿ™ŸÖÿßÿ≥</label>
                        <input type="tel" class="form-input" id="contactPhone" required />
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="contactText">ŸÖÿ™ŸÜ</label>
                        <textarea class="form-textarea" id="contactText" required></textarea>
                    </div>
                    <button type="submit" class="form-submit-btn" id="contactSubmitBtn">ÿßÿ±ÿ≥ÿßŸÑ</button>
                </form>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" id="closeContactModalBtn">ÿ®ÿ≥ÿ™ŸÜ</button>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">Ÿàÿ±ŸàÿØ</div>
            <div class="modal-body">
                <form id="loginForm">
                    <div class="form-group">
                        <label class="form-label" for="loginUsername">ŸÜÿßŸÖ ⁄©ÿßÿ±ÿ®ÿ±€å</label>
                        <input type="text" class="form-input" id="loginUsername" required />
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="loginPassword">ÿ±ŸÖÿ≤ ÿπÿ®Ÿàÿ±</label>
                        <input type="password" class="form-input" id="loginPassword" required />
                    </div>
                    <button type="submit" class="form-submit-btn" id="loginSubmitBtn">Ÿàÿ±ŸàÿØ</button>
                </form>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" id="closeLoginModalBtn">ÿ®ÿ≥ÿ™ŸÜ</button>
            </div>
        </div>
    </div>

    <!-- Gold Price Modal -->
    <div class="modal" id="goldPriceModal">
        <div class="modal-content">
            <div class="modal-header">ŸÇ€åŸÖÿ™ ÿ±Ÿàÿ≤ ÿ∑ŸÑÿß</div>
            <div class="modal-body">
                <div id="goldPriceContainer" class="gold-price-container">
                    <div class="loading">ÿØÿ± ÿ≠ÿßŸÑ ÿ®ÿßÿ±⁄Øÿ∞ÿßÿ±€å...</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" id="closeGoldPriceModalBtn">ÿ®ÿ≥ÿ™ŸÜ</button>
            </div>
        </div>
    </div>

    <!-- Support Modal -->
    <div class="modal" id="supportModal">
        <div class="modal-content">
            <div class="modal-header">Ÿæÿ¥ÿ™€åÿ®ÿßŸÜ€å</div>
            <div class="modal-body">
                <form id="supportForm">
                    <div class="form-group">
                        <label class="form-label" for="supportText">ŸÖÿ™ŸÜ</label>
                        <textarea class="form-textarea" id="supportText" required></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="supportNumber">ÿ¥ŸÖÿßÿ±Ÿá</label>
                        <input type="tel" class="form-input" id="supportNumber" required />
                    </div>
                    <button type="submit" class="form-submit-btn" id="supportSubmitBtn">ÿßÿ±ÿ≥ÿßŸÑ</button>
                </form>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" id="closeSupportModalBtn">ÿ®ÿ≥ÿ™ŸÜ</button>
            </div>
        </div>
    </div>

    <!-- Admin Delete/Edit Page -->
    <div class="admin-page" id="deleteEditPage" style="display: none;">
        <div class="admin-page-content">
            <button class="admin-page-back-btn" id="deleteEditPageBackBtn">‚Üê</button>
            <div class="delete-edit-bottom-container">
                <label class="delete-edit-label" for="deleteEditInput">⁄©ÿØ ÿ∑ŸÑÿß €åÿß ÿ™Ÿàÿ∂€åÿ≠ÿßÿ™ ŸÖÿ≠ÿµŸàŸÑ</label>
                <form id="deleteEditForm" class="delete-edit-form">
                    <input type="text" class="delete-edit-input" id="deleteEditInput" required />
                    <button type="submit" class="delete-edit-send-btn" id="deleteEditSubmitBtn">
                        <span class="send-icon">‚Üë</span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Admin Add Page -->
    <div class="admin-page" id="addPage" style="display: none;">
        <div class="admin-page-content">
            <button class="admin-page-back-btn" id="addPageBackBtn">‚Üê</button>
            <form id="addForm">
                <div class="admin-form-group">
                    <label class="admin-form-label">ÿ®ÿßÿ±⁄Øÿ∞ÿßÿ±€å ÿ™ÿµŸà€åÿ±</label>
                    <div class="image-upload-area">
                        <input type="file" id="imageInput" accept="image/*" />
                        <div class="image-preview" id="imagePreview">
                            <div class="image-upload-placeholder">
                                <span class="upload-icon">üìé</span>
                                <span class="upload-text">ÿ®ÿßÿ±⁄Øÿ∞ÿßÿ±€å ÿ™ÿµŸà€åÿ±</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="admin-form-group">
                    <label class="admin-form-label" for="goldCode">⁄©ÿØ ÿ∑ŸÑÿß</label>
                    <input type="text" class="admin-form-input" id="goldCode" required />
                </div>
                <div class="admin-form-group">
                    <label class="admin-form-label" for="productDescription">ÿ™Ÿàÿ∂€åÿ≠ÿßÿ™ ŸÖÿ≠ÿµŸàŸÑ</label>
                    <input type="text" class="admin-form-input" id="productDescription" required />
                </div>
                <button type="submit" class="admin-send-btn" id="addSubmitBtn">
                    <span class="send-icon">‚Üë</span>
                </button>
            </form>
        </div>
    </div>

    <!-- Colored Pages -->
    <div class="colored-page green" id="greenPage">
        <div class="colored-page-content">
            <h2>ÿπŸÖŸÑ€åÿßÿ™ ÿ®ÿß ŸÖŸàŸÅŸÇ€åÿ™ ÿßŸÜÿ¨ÿßŸÖ ÿ¥ÿØ</h2>
            <button class="colored-page-close" id="closeGreenPageBtn">ÿ®ÿ≥ÿ™ŸÜ</button>
        </div>
    </div>

    <div class="colored-page red" id="redPage">
        <div class="colored-page-content">
            <h2>ÿπŸÖŸÑ€åÿßÿ™ ÿ≠ÿ∞ŸÅ ÿßŸÜÿ¨ÿßŸÖ ÿ¥ÿØ</h2>
            <button class="colored-page-close" id="closeRedPageBtn">ÿ®ÿ≥ÿ™ŸÜ</button>
        </div>
    </div>

    <script>
        const WEBHOOK_URL = 'https://33140-nwo6p.s1.irann8n.com/webhook-test/df17942e-9b77-4e51-84e5-6301cd0a930b';
        const CONTACT_WEBHOOK_URL = 'https://33140-nwo6p.s1.irann8n.com/webhook-test/df17942e-9b77-4e51-84e5-6301cd0a930b';
        const GOLD_PRICE_WEBHOOK_URL = 'https://33140-nwo6p.s1.irann8n.com/webhook-test/bc5d867f-e95f-412f-921f-1819407f27fa';
        const LOGIN_WEBHOOK_URL = 'https://33140-nwo6p.s1.irann8n.com/webhook-test/de4e77d3-0c12-4309-8dd3-1f657b62bfb6';
        const ADMIN_WEBHOOK_URL = 'https://33140-nwo6p.s1.irann8n.com/webhook-test/0bb445e1-3e17-4af3-b6f5-668723e9a53c';
        const PAGE_NAVIGATION_WEBHOOK_URL = 'https://33140-nwo6p.s1.irann8n.com/webhook-test/91991a96-0cdd-4dbc-860b-3dc9729a1823';
        let isSending = false;
        
        // Token and user management
        function getToken() {
            return localStorage.getItem('authToken');
        }
        
        function getUsername() {
            return localStorage.getItem('username');
        }
        
        function setToken(token) {
            if (token) {
                localStorage.setItem('authToken', token);
            } else {
                localStorage.removeItem('authToken');
            }
        }
        
        function setUsername(username) {
            if (username) {
                localStorage.setItem('username', username);
            } else {
                localStorage.removeItem('username');
            }
        }
        
        function clearToken() {
            localStorage.removeItem('authToken');
            localStorage.removeItem('username');
        }

        // Check if user is authenticated
        function isAuthenticated() {
            const token = getToken();
            return token !== null && token !== undefined && token !== '';
        }

        // Redirect to login if not authenticated
        function requireAuth() {
            if (!isAuthenticated()) {
                clearToken();
                mainHeader.classList.remove('header-admin-mode');
                adminDashboard.classList.remove('show');
                if (typeof addPage !== 'undefined' && addPage) {
                    addPage.classList.remove('show');
                    addPage.style.display = 'none';
                }
                if (typeof deleteEditPage !== 'undefined' && deleteEditPage) {
                    deleteEditPage.classList.remove('show');
                    deleteEditPage.style.display = 'none';
                }
                mainContentArea.style.display = 'block';
                document.querySelector('.search-bar').style.display = 'flex';
                loginModal.classList.add('show');
                alert('ŸÑÿ∑ŸÅÿßŸã ÿßÿ®ÿ™ÿØÿß Ÿàÿßÿ±ÿØ ÿ¥Ÿà€åÿØ');
                return false;
            }
            return true;
        }

        // Helper function to send authenticated requests with token and username
        async function sendAuthenticatedRequest(action, additionalData = {}) {
            const token = getToken();
            const username = getUsername();
            
            if (!token) {
                alert('ŸÑÿ∑ŸÅÿßŸã ÿßÿ®ÿ™ÿØÿß Ÿàÿßÿ±ÿØ ÿ¥Ÿà€åÿØ');
                requireAuth();
                return null;
            }
            
            const payload = {
                action: action,
                token: token,
                username: username,
                timestamp: new Date().toISOString(),
                ...additionalData
            };
            
            try {
                const response = await fetch(ADMIN_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    if (errorData.message && (errorData.message.includes('token') || errorData.message.includes('unauthorized'))) {
                        clearToken();
                        requireAuth();
                        return null;
                    }
                    throw new Error(errorData.message || 'ÿÆÿ∑ÿß ÿØÿ± ÿßÿ±ÿ™ÿ®ÿßÿ∑ ÿ®ÿß ÿ≥ÿ±Ÿàÿ±');
                }
                
                return await response.json();
            } catch (error) {
                console.error(`Error in ${action}:`, error);
                throw error;
            }
        }

        // Store list
        const stores = ['ÿ¨ŸàÿßŸáÿ±€å ÿ≥ÿ™ÿßÿ±ÿ≤ÿßÿØŸá', 'ŸÅÿ±Ÿàÿ¥⁄ØÿßŸá €±', 'ŸÅÿ±Ÿàÿ¥⁄ØÿßŸá €≤'];
        let selectedStore = stores[0];

        // DOM Elements
        const storeSelectorBtn = document.getElementById('storeSelectorBtn');
        const storeDropdown = document.getElementById('storeDropdown');
        const addressBtn = document.getElementById('addressBtn');
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const searchResults = document.getElementById('searchResults');
        const addressModal = document.getElementById('addressModal');
        const modalAddress = document.getElementById('modalAddress');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const viewMapBtn = document.getElementById('viewMapBtn');
        
        // Menu and Accordion Elements
        const menuBtn = document.getElementById('menuBtn');
        const backBtn = document.getElementById('backBtn');
        const accordionMenu = document.getElementById('accordionMenu');
        const contactMenuItem = document.getElementById('contactMenuItem');
        const loginMenuItem = document.getElementById('loginMenuItem');
        
        // Modal Elements
        const contactModal = document.getElementById('contactModal');
        const loginModal = document.getElementById('loginModal');
        const goldPriceModal = document.getElementById('goldPriceModal');
        const contactForm = document.getElementById('contactForm');
        const loginForm = document.getElementById('loginForm');
        const contactSubmitBtn = document.getElementById('contactSubmitBtn');
        const loginSubmitBtn = document.getElementById('loginSubmitBtn');
        const closeContactModalBtn = document.getElementById('closeContactModalBtn');
        const closeLoginModalBtn = document.getElementById('closeLoginModalBtn');
        const closeGoldPriceModalBtn = document.getElementById('closeGoldPriceModalBtn');
        const goldPriceContainer = document.getElementById('goldPriceContainer');
        
        // Admin Dashboard Elements
        const mainHeader = document.getElementById('mainHeader');
        const mainContentArea = document.getElementById('mainContentArea');
        const adminDashboard = document.getElementById('adminDashboard');
        const headerSupportBtn = document.getElementById('headerSupportBtn');
        const headerProductsBtn = document.getElementById('headerProductsBtn');
        const updatePricesBtn = document.getElementById('updatePricesBtn');
        const deleteEditBtn = document.getElementById('deleteEditBtn');
        const addBtn = document.getElementById('addBtn');
        const supportModal = document.getElementById('supportModal');
        const supportForm = document.getElementById('supportForm');
        const supportSubmitBtn = document.getElementById('supportSubmitBtn');
        const closeSupportModalBtn = document.getElementById('closeSupportModalBtn');
        const greenPage = document.getElementById('greenPage');
        const redPage = document.getElementById('redPage');
        const closeGreenPageBtn = document.getElementById('closeGreenPageBtn');
        const closeRedPageBtn = document.getElementById('closeRedPageBtn');
        const addPage = document.getElementById('addPage');
        const addForm = document.getElementById('addForm');
        const imageInput = document.getElementById('imageInput');
        const imagePreview = document.getElementById('imagePreview');
        const addSubmitBtn = document.getElementById('addSubmitBtn');
        const addPageBackBtn = document.getElementById('addPageBackBtn');
        const deleteEditPage = document.getElementById('deleteEditPage');
        const deleteEditForm = document.getElementById('deleteEditForm');
        const deleteEditInput = document.getElementById('deleteEditInput');
        const deleteEditSubmitBtn = document.getElementById('deleteEditSubmitBtn');
        const deleteEditPageBackBtn = document.getElementById('deleteEditPageBackBtn');

        // Store selector functionality
        storeSelectorBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            storeDropdown.classList.toggle('show');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            if (!storeSelectorBtn.contains(e.target) && !storeDropdown.contains(e.target)) {
                storeDropdown.classList.remove('show');
            }
        });

        // Store option selection
        storeDropdown.querySelectorAll('.store-option').forEach(option => {
            option.addEventListener('click', function() {
                selectedStore = this.getAttribute('data-store');
                storeSelectorBtn.textContent = selectedStore;
                storeDropdown.classList.remove('show');
            });
        });

        function clearEmptyState() {
            const emptyState = searchResults.querySelector('.empty-state');
            if (emptyState) {
                emptyState.remove();
            }
        }

        function scrollToBottom() {
            searchResults.scrollTop = searchResults.scrollHeight;
        }

        function appendMessage(role, content, options = {}) {
            clearEmptyState();

            const messageEl = document.createElement('div');
            messageEl.classList.add('message', role === 'user' ? 'message-user' : 'message-bot');

            if (options.isPending) {
                messageEl.classList.add('typing-dots');
            }

            if (typeof content === 'string') {
                messageEl.textContent = content;
            } else if (content instanceof Node) {
                messageEl.appendChild(content);
            } else {
                messageEl.textContent = '';
            }

            searchResults.appendChild(messageEl);
            scrollToBottom();

            return messageEl;
        }

        function updateMessage(messageEl, content) {
            if (!messageEl) return;
            messageEl.classList.remove('typing-dots');

            if (typeof content === 'string') {
                messageEl.textContent = content;
            } else if (content instanceof Node) {
                messageEl.innerHTML = '';
                messageEl.appendChild(content);
            } else {
                messageEl.textContent = '';
            }

            scrollToBottom();
        }

        function setSearchState(isLoading) {
            isSending = isLoading;
            searchBtn.disabled = isLoading;
            if (!isLoading) {
                searchInput.focus();
            }
        }

        function createTextContent(text) {
            const wrapper = document.createElement('div');
            wrapper.className = 'message-text';
            wrapper.textContent = text;
            return wrapper;
        }

        function createImageContent({ url, caption }) {
            const figure = document.createElement('figure');
            figure.className = 'message-media';

            const img = document.createElement('img');
            img.src = url;
            img.alt = caption || 'ÿ™ÿµŸà€åÿ±';
            img.loading = 'lazy';
            figure.appendChild(img);

            if (caption) {
                const figcaption = document.createElement('figcaption');
                figcaption.textContent = caption;
                figure.appendChild(figcaption);
            }

            return figure;
        }

        function createLocationContent({ latitude, longitude, text }) {
            const container = document.createElement('div');
            container.className = 'message-location';

            const description = document.createElement('div');
            description.textContent = text || 'ŸÖŸàŸÇÿπ€åÿ™ ŸÅÿ±Ÿàÿ¥⁄ØÿßŸá';

            const link = document.createElement('a');
            link.href = `https://www.google.com/maps?q=${latitude},${longitude}`;
            link.target = '_blank';
            link.rel = 'noopener noreferrer';
            link.textContent = 'ŸÖÿ¥ÿßŸáÿØŸá ÿ±Ÿà€å ŸÜŸÇÿ¥Ÿá';

            const coords = document.createElement('div');
            coords.className = 'location-coords';
            coords.textContent = `${latitude}, ${longitude}`;

            container.appendChild(description);
            container.appendChild(coords);
            container.appendChild(link);

            return container;
        }

        function detectInlineImageSource(value) {
            if (!value && value !== 0) {
                return null;
            }

            const trimmed = String(value).trim();

            if (!trimmed) {
                return null;
            }

            if (trimmed.startsWith('data:image')) {
                return trimmed;
            }

            if (/^https?:\/\/.+\.(png|jpe?g|gif|webp)(\?.*)?$/i.test(trimmed)) {
                return trimmed;
            }

            const sanitized = trimmed.replace(/\s+/g, '');
            const base64Hints = ['iVBOR', '/9j', 'R0lGOD', 'Qk2', 'Qk0', 'AAAB', 'UEsD'];
            const looksBase64 = /^[A-Za-z0-9+/=]+$/.test(sanitized) && base64Hints.some(hint => sanitized.startsWith(hint));

            if (looksBase64) {
                let mime = 'image/jpeg';
                if (sanitized.startsWith('iVBOR')) mime = 'image/png';
                else if (sanitized.startsWith('R0lGOD')) mime = 'image/gif';
                else if (sanitized.startsWith('Qk')) mime = 'image/bmp';

                return `data:${mime};base64,${sanitized}`;
            }

            return null;
        }

        function inferResponseType(data) {
            if (!data || typeof data !== 'object') {
                return 'text';
            }

            if (data.type) {
                return data.type;
            }

            if (data.latitude || data.lat) {
                return 'location';
            }

            if (data.url || data.image || data.image_url || data.photo) {
                return 'image';
            }

            return 'text';
        }

        const ARRAY_KEYS = [
            'items',
            'results',
            'data',
            'messages',
            'entries',
            'list',
            'payload',
            'value',
            'photos',
            'images',
            'media',
            'gallery',
            'files'
        ];

        function normalizeResponse(raw) {
            if (raw === null || raw === undefined) {
                return [];
            }

            if (typeof raw === 'string' || typeof raw === 'number') {
                const value = String(raw).trim();
                const inlineImage = detectInlineImageSource(value);
                if (inlineImage) {
                    return [{ type: 'image', url: inlineImage }];
                }
                return [{ type: 'text', text: value }];
            }

            if (Array.isArray(raw)) {
                return raw.flatMap(item => normalizeResponse(item));
            }

            if (typeof raw === 'object') {
                for (const key of ARRAY_KEYS) {
                    if (Array.isArray(raw[key])) {
                        const expanded = raw[key].flatMap(item => normalizeResponse(item));
                        if (expanded.length) {
                            return expanded;
                        }
                    }
                }

                const type = inferResponseType(raw);
                if (type === 'image') {
                    let source = raw.url || raw.image || raw.image_url || raw.photo;
                    if (!source && raw.data) {
                        source = detectInlineImageSource(raw.data);
                        if (!source) {
                            const mime = raw.mime || raw.mimetype || 'image/jpeg';
                            source = `data:${mime};base64,${String(raw.data).replace(/\s+/g, '')}`;
                        }
                    }

                    if (source) {
                        return [{
                            type: 'image',
                            url: source,
                            caption: raw.caption || raw.info || raw.text || raw.description || ''
                        }];
                    }
                }

                if (type === 'location') {
                    return [{
                        type: 'location',
                        latitude: raw.latitude || raw.lat,
                        longitude: raw.longitude || raw.lng || raw.lon,
                        text: raw.text || raw.caption || raw.description || ''
                    }];
                }

                const text = raw.text || raw.message || raw.caption || raw.description;
                if (text) {
                    return [{ type: 'text', text }];
                }

                return [{ type: 'text', text: JSON.stringify(raw, null, 2) }];
            }

            return [{ type: 'text', text: String(raw) }];
        }

        async function extractResponses(response) {
            const rawContentType = response.headers.get('content-type') || '';
            const contentType = rawContentType.toLowerCase();
            const disposition = response.headers.get('content-disposition') || '';
            const filenameSuggestsImage = /\.(png|jpe?g|gif|webp)/i.test(disposition);
            const isImage = contentType.startsWith('image/');
            const isBinary = contentType === 'application/octet-stream';

            if (isImage || isBinary || (!contentType && filenameSuggestsImage)) {
                const blob = await response.blob();
                const objectUrl = URL.createObjectURL(blob);
                return [{
                    type: 'image',
                    url: objectUrl,
                    caption: response.headers.get('x-caption') || ''
                }];
            }

            let payload;
            try {
                if (contentType.includes('application/json')) {
                    payload = await response.json();
                } else if (contentType.startsWith('text/') || contentType.includes('xml') || contentType.includes('html') || !contentType) {
                    const text = await response.text();
                    try {
                        payload = text ? JSON.parse(text) : '';
                    } catch {
                        payload = text;
                    }
                } else {
                    const blob = await response.blob();
                    const objectUrl = URL.createObjectURL(blob);
                    return [{
                        type: 'image',
                        url: objectUrl,
                        caption: response.headers.get('x-caption') || ''
                    }];
                }
            } catch (error) {
                console.error('Failed to parse response payload:', error);
                payload = '';
            }

            return normalizeResponse(payload);
        }

        function renderMessageContent(targetEl, payload) {
            if (!payload) {
                updateMessage(targetEl, 'Ÿæÿßÿ≥ÿÆ€å ÿØÿ±€åÿßŸÅÿ™ ŸÜÿ¥ÿØ');
                return;
            }

            if (payload.type === 'image' && payload.url) {
                updateMessage(targetEl, createImageContent(payload));
                return;
            }

            if (payload.type === 'location' && payload.latitude && payload.longitude) {
                updateMessage(targetEl, createLocationContent(payload));
                return;
            }

            updateMessage(targetEl, createTextContent(payload.text || 'Ÿæÿßÿ≥ÿÆ€å ÿØÿ±€åÿßŸÅÿ™ ŸÜÿ¥ÿØ'));
        }

        async function sendSearchQuery() {
            if (isSending) {
                return;
            }

            const query = searchInput.value.trim();

            if (!query) {
                return;
            }

            searchInput.value = '';

            appendMessage('user', query);
            const botPlaceholder = appendMessage('bot', 'ÿØÿ± ÿ≠ÿßŸÑ ÿØÿ±€åÿßŸÅÿ™ Ÿæÿßÿ≥ÿÆ...', { isPending: true });

            setSearchState(true);

            const payload = {
                store: selectedStore,
                query,
                timestamp: new Date().toISOString()
            };

            try {
                const response = await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                const responses = await extractResponses(response);

                if (!response.ok) {
                    const message = responses[0]?.text || 'ÿÆÿ∑ÿß€å ŸÜÿßÿ¥ŸÜÿßÿÆÿ™Ÿá';
                    throw new Error(message);
                }

                if (!responses.length) {
                    updateMessage(botPlaceholder, 'Ÿæÿßÿ≥ÿÆ€å ÿØÿ±€åÿßŸÅÿ™ ŸÜÿ¥ÿØ');
                } else {
                    renderMessageContent(botPlaceholder, responses[0]);
                    if (responses.length > 1) {
                        responses.slice(1).forEach(item => {
                            const extraMessage = appendMessage('bot', '');
                            renderMessageContent(extraMessage, item);
                        });
                    }
                }
            } catch (error) {
                console.error('n8n webhook error:', error);
                updateMessage(botPlaceholder, 'ÿÆÿ∑ÿß ÿØÿ± ÿØÿ±€åÿßŸÅÿ™ Ÿæÿßÿ≥ÿÆ. ŸÑÿ∑ŸÅÿßŸã ÿØŸàÿ®ÿßÿ±Ÿá ÿ™ŸÑÿßÿ¥ ⁄©ŸÜ€åÿØ.');
            } finally {
                setSearchState(false);
            }
        }

        // Search button click
        searchBtn.addEventListener('click', sendSearchQuery);

        // Enter key in search input
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendSearchQuery();
            }
        });

        // Address functionality
        function showAddressLocation() {
            // Show modal
            addressModal.classList.add('show');
            modalAddress.textContent = 'ÿØÿ± ÿ≠ÿßŸÑ ÿ®ÿßÿ±⁄Øÿ∞ÿßÿ±€å ÿ¢ÿØÿ±ÿ≥...';

            // Prepare data for n8n webhook
            const webhookData = {
                store: selectedStore,
                action: 'get_address',
                timestamp: new Date().toISOString()
            };

            // Log to console (simulating webhook call)
            console.log('Sending address request to n8n Webhook:', webhookData);
            console.log('POST URL: https://your-n8n-webhook-url.com/webhook/address');

            // Simulate API call delay
            setTimeout(() => {
                // Mock address data
                const mockAddress = {
                    text: 'ÿ™Ÿáÿ±ÿßŸÜÿå ÿÆ€åÿßÿ®ÿßŸÜ ŸàŸÑ€åÿπÿµÿ±ÿå ŸæŸÑÿß⁄© €±€≤€≥ÿå ŸÅÿ±Ÿàÿ¥⁄ØÿßŸá ÿ¨ŸàÿßŸáÿ±€å ÿ≥ÿ™ÿßÿ±ÿ≤ÿßÿØŸá',
                    latitude: 35.6892,
                    longitude: 51.3890
                };

                modalAddress.textContent = mockAddress.text;
                
                // Store coordinates for map view
                viewMapBtn.onclick = function() {
                    openGoogleMaps(mockAddress.latitude, mockAddress.longitude);
                };
            }, 500);
        }

        function openGoogleMaps(lat, lng) {
            const url = `https://www.google.com/maps?q=${lat},${lng}`;
            window.open(url, '_blank');
        }

        // Address button click
        addressBtn.addEventListener('click', showAddressLocation);

        // Modal close functionality
        closeModalBtn.addEventListener('click', function() {
            addressModal.classList.remove('show');
        });

        // Close modal when clicking outside
        addressModal.addEventListener('click', function(e) {
            if (e.target === addressModal) {
                addressModal.classList.remove('show');
            }
        });

        // Menu button click - toggle accordion
        menuBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            accordionMenu.classList.toggle('show');
        });

        // Close accordion when clicking outside
        document.addEventListener('click', function(e) {
            if (!menuBtn.contains(e.target) && !accordionMenu.contains(e.target)) {
                accordionMenu.classList.remove('show');
            }
        });

        // Accordion menu item clicks
        contactMenuItem.addEventListener('click', function() {
            accordionMenu.classList.remove('show');
            contactModal.classList.add('show');
        });

        loginMenuItem.addEventListener('click', function() {
            accordionMenu.classList.remove('show');
            loginModal.classList.add('show');
        });

        // Contact form submission
        contactForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const name = document.getElementById('contactName').value.trim();
            const phone = document.getElementById('contactPhone').value.trim();
            const text = document.getElementById('contactText').value.trim();

            if (!name || !phone || !text) {
                alert('ŸÑÿ∑ŸÅÿßŸã ÿ™ŸÖÿßŸÖ ŸÅ€åŸÑÿØŸáÿß ÿ±ÿß Ÿæÿ± ⁄©ŸÜ€åÿØ');
                return;
            }

            contactSubmitBtn.disabled = true;
            contactSubmitBtn.textContent = 'ÿØÿ± ÿ≠ÿßŸÑ ÿßÿ±ÿ≥ÿßŸÑ...';

            try {
                const response = await fetch(CONTACT_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'contact',
                        name: name,
                        phone: phone,
                        text: text,
                        timestamp: new Date().toISOString()
                    })
                });

                if (response.ok) {
                    alert('Ÿæ€åÿßŸÖ ÿ¥ŸÖÿß ÿ®ÿß ŸÖŸàŸÅŸÇ€åÿ™ ÿßÿ±ÿ≥ÿßŸÑ ÿ¥ÿØ');
                    contactForm.reset();
                    contactModal.classList.remove('show');
                } else {
                    alert('ÿÆÿ∑ÿß ÿØÿ± ÿßÿ±ÿ≥ÿßŸÑ Ÿæ€åÿßŸÖ. ŸÑÿ∑ŸÅÿßŸã ÿØŸàÿ®ÿßÿ±Ÿá ÿ™ŸÑÿßÿ¥ ⁄©ŸÜ€åÿØ.');
                }
            } catch (error) {
                console.error('Contact form error:', error);
                alert('ÿÆÿ∑ÿß ÿØÿ± ÿßÿ±ÿ≥ÿßŸÑ Ÿæ€åÿßŸÖ. ŸÑÿ∑ŸÅÿßŸã ÿØŸàÿ®ÿßÿ±Ÿá ÿ™ŸÑÿßÿ¥ ⁄©ŸÜ€åÿØ.');
            } finally {
                contactSubmitBtn.disabled = false;
                contactSubmitBtn.textContent = 'ÿßÿ±ÿ≥ÿßŸÑ';
            }
        });

        // Login form submission
        loginForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value.trim();

            if (!username || !password) {
                alert('ŸÑÿ∑ŸÅÿßŸã ŸÜÿßŸÖ ⁄©ÿßÿ±ÿ®ÿ±€å Ÿà ÿ±ŸÖÿ≤ ÿπÿ®Ÿàÿ± ÿ±ÿß Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ');
                return;
            }

            loginSubmitBtn.disabled = true;
            loginSubmitBtn.textContent = 'ÿØÿ± ÿ≠ÿßŸÑ Ÿàÿ±ŸàÿØ...';

            try {
                const response = await fetch(LOGIN_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'login',
                        username: username,
                        password: password,
                        timestamp: new Date().toISOString()
                    })
                });

                const data = await response.json();
                
                if (response.ok && data.token) {
                    // Store the token and username
                    setToken(data.token);
                    setUsername(username);
                    loginForm.reset();
                    loginModal.classList.remove('show');
                    // Show admin dashboard and hide main content
                    mainContentArea.style.display = 'none';
                    document.querySelector('.search-bar').style.display = 'none';
                    mainHeader.classList.add('header-admin-mode');
                    adminDashboard.classList.add('show');
                } else {
                    alert(data.message || 'ŸÜÿßŸÖ ⁄©ÿßÿ±ÿ®ÿ±€å €åÿß ÿ±ŸÖÿ≤ ÿπÿ®Ÿàÿ± ÿßÿ¥ÿ™ÿ®ÿßŸá ÿßÿ≥ÿ™');
                }
            } catch (error) {
                console.error('Login error:', error);
                alert('ÿÆÿ∑ÿß ÿØÿ± Ÿàÿ±ŸàÿØ. ŸÑÿ∑ŸÅÿßŸã ÿØŸàÿ®ÿßÿ±Ÿá ÿ™ŸÑÿßÿ¥ ⁄©ŸÜ€åÿØ.');
            } finally {
                loginSubmitBtn.disabled = false;
                loginSubmitBtn.textContent = 'Ÿàÿ±ŸàÿØ';
            }
        });

        // Back button handler
        backBtn.addEventListener('click', function() {
            // If on add page, go back to admin dashboard
            if (addPage && (addPage.style.display === 'block' || addPage.classList.contains('show'))) {
                addPage.classList.remove('show');
                addPage.style.display = 'none';
                adminDashboard.classList.add('show');
                backBtn.style.display = 'none';
                return;
            }
            
            // If on delete/edit page, go back to admin dashboard
            if (deleteEditPage && (deleteEditPage.style.display === 'block' || deleteEditPage.classList.contains('show'))) {
                deleteEditPage.classList.remove('show');
                deleteEditPage.style.display = 'none';
                adminDashboard.classList.add('show');
                backBtn.style.display = 'none';
                return;
            }
            
            // Otherwise, clear token and go back to main page
            clearToken();
            mainHeader.classList.remove('header-admin-mode');
            adminDashboard.classList.remove('show');
            mainContentArea.style.display = 'block';
            document.querySelector('.search-bar').style.display = 'flex';
        });

        // Fetch gold prices
        async function fetchGoldPrices() {
            goldPriceContainer.innerHTML = '<div class="loading">ÿØÿ± ÿ≠ÿßŸÑ ÿ®ÿßÿ±⁄Øÿ∞ÿßÿ±€å...</div>';

            try {
                const response = await fetch(GOLD_PRICE_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'get_gold_prices',
                        timestamp: new Date().toISOString()
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to fetch gold prices');
                }

                const data = await response.json();
                displayGoldPrices(data);
            } catch (error) {
                console.error('Gold price error:', error);
                goldPriceContainer.innerHTML = '<div class="loading" style="color: #ff3b30;">ÿÆÿ∑ÿß ÿØÿ± ÿØÿ±€åÿßŸÅÿ™ ŸÇ€åŸÖÿ™‚ÄåŸáÿß. ŸÑÿ∑ŸÅÿßŸã ÿØŸàÿ®ÿßÿ±Ÿá ÿ™ŸÑÿßÿ¥ ⁄©ŸÜ€åÿØ.</div>';
            }
        }

        // Display gold prices
        function displayGoldPrices(data) {
            if (!data || typeof data !== 'object') {
                goldPriceContainer.innerHTML = '<div class="loading">ÿßÿ∑ŸÑÿßÿπÿßÿ™€å ÿØÿ±€åÿßŸÅÿ™ ŸÜÿ¥ÿØ</div>';
                return;
            }

            let html = '';
            
            // If data is an array
            if (Array.isArray(data)) {
                data.forEach(item => {
                    if (typeof item === 'object') {
                        Object.entries(item).forEach(([key, value]) => {
                            html += `
                                <div class="gold-price-item">
                                    <span class="gold-price-label">${key}</span>
                                    <span class="gold-price-value">${value}</span>
                                </div>
                            `;
                        });
                    }
                });
            } else {
                // If data is an object
                Object.entries(data).forEach(([key, value]) => {
                    if (typeof value === 'object' && value !== null) {
                        html += `
                            <div class="gold-price-item" style="flex-direction: column; align-items: flex-start; gap: 8px;">
                                <span class="gold-price-label" style="font-size: 16px; font-weight: 600;">${key}</span>
                        `;
                        Object.entries(value).forEach(([subKey, subValue]) => {
                            html += `
                                <div style="display: flex; justify-content: space-between; width: 100%; padding-right: 16px;">
                                    <span class="gold-price-label">${subKey}</span>
                                    <span class="gold-price-value">${subValue}</span>
                                </div>
                            `;
                        });
                        html += `</div>`;
                    } else {
                        html += `
                            <div class="gold-price-item">
                                <span class="gold-price-label">${key}</span>
                                <span class="gold-price-value">${value}</span>
                            </div>
                        `;
                    }
                });
            }

            goldPriceContainer.innerHTML = html || '<div class="loading">ÿßÿ∑ŸÑÿßÿπÿßÿ™€å ÿØÿ±€åÿßŸÅÿ™ ŸÜÿ¥ÿØ</div>';
        }

        // Close modals
        closeContactModalBtn.addEventListener('click', function() {
            contactModal.classList.remove('show');
        });

        closeLoginModalBtn.addEventListener('click', function() {
            loginModal.classList.remove('show');
        });

        closeGoldPriceModalBtn.addEventListener('click', function() {
            goldPriceModal.classList.remove('show');
        });

        // Close modals when clicking outside
        contactModal.addEventListener('click', function(e) {
            if (e.target === contactModal) {
                contactModal.classList.remove('show');
            }
        });

        loginModal.addEventListener('click', function(e) {
            if (e.target === loginModal) {
                loginModal.classList.remove('show');
            }
        });

        goldPriceModal.addEventListener('click', function(e) {
            if (e.target === goldPriceModal) {
                goldPriceModal.classList.remove('show');
            }
        });

        // Admin Dashboard Button Handlers
        headerSupportBtn.addEventListener('click', function() {
            supportModal.classList.add('show');
        });

        headerProductsBtn.addEventListener('click', async function() {
            // 10 ŸÖÿ≠ÿµŸàŸÑ ÿ¢ÿÆÿ± - trigger webhook
            if (!requireAuth()) return;
            
            try {
                const token = getToken();
                const username = getUsername();
                
                if (!token) {
                    alert('ŸÑÿ∑ŸÅÿßŸã ÿßÿ®ÿ™ÿØÿß Ÿàÿßÿ±ÿØ ÿ¥Ÿà€åÿØ');
                    return;
                }
                
                const response = await fetch(ADMIN_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'last_products',
                        token: token,
                        username: username,
                        timestamp: new Date().toISOString()
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    if (errorData.message && errorData.message.includes('token') || errorData.message && errorData.message.includes('unauthorized')) {
                        clearToken();
                        requireAuth();
                        return;
                    }
                }
                
                const data = await response.json();
                // Handle response if needed
                console.log('Last products response:', data);
            } catch (error) {
                console.error('Last products error:', error);
                alert('ÿÆÿ∑ÿß ÿØÿ± ÿØÿ±€åÿßŸÅÿ™ ÿßÿ∑ŸÑÿßÿπÿßÿ™');
            }
        });

        updatePricesBtn.addEventListener('click', async function() {
            // ÿ¢ŸæÿØ€åÿ™ ŸÇ€åŸÖÿ™ Ÿáÿß - trigger webhook
            if (!requireAuth()) return;
            
            try {
                const token = getToken();
                const username = getUsername();
                
                if (!token) {
                    alert('ŸÑÿ∑ŸÅÿßŸã ÿßÿ®ÿ™ÿØÿß Ÿàÿßÿ±ÿØ ÿ¥Ÿà€åÿØ');
                    return;
                }
                
                const response = await fetch(ADMIN_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'update_prices',
                        token: token,
                        username: username,
                        timestamp: new Date().toISOString()
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    if (errorData.message && (errorData.message.includes('token') || errorData.message.includes('unauthorized'))) {
                        clearToken();
                        requireAuth();
                        return;
                    }
                    throw new Error('ÿÆÿ∑ÿß ÿØÿ± ÿ®Ÿá‚Äåÿ±Ÿàÿ≤ÿ±ÿ≥ÿßŸÜ€å ŸÇ€åŸÖÿ™‚ÄåŸáÿß');
                }
                
                const data = await response.json();
                if (response.ok) {
                    alert('ŸÇ€åŸÖÿ™‚ÄåŸáÿß ÿ®ÿß ŸÖŸàŸÅŸÇ€åÿ™ ÿ®Ÿá‚Äåÿ±Ÿàÿ≤ÿ±ÿ≥ÿßŸÜ€å ÿ¥ÿØŸÜÿØ');
                }
            } catch (error) {
                console.error('Update prices error:', error);
                alert('ÿÆÿ∑ÿß ÿØÿ± ÿ®Ÿá‚Äåÿ±Ÿàÿ≤ÿ±ÿ≥ÿßŸÜ€å ŸÇ€åŸÖÿ™‚ÄåŸáÿß');
            }
        });

        deleteEditBtn.addEventListener('click', async function() {
            // ÿ≠ÿ∞ŸÅ €åÿß ÿßÿØ€åÿ™ - trigger webhook and check response
            if (!requireAuth()) return;
            
            try {
                const token = getToken();
                const username = getUsername();
                
                if (!token) {
                    alert('ŸÑÿ∑ŸÅÿßŸã ÿßÿ®ÿ™ÿØÿß Ÿàÿßÿ±ÿØ ÿ¥Ÿà€åÿØ');
                    return;
                }
                
                const response = await fetch(PAGE_NAVIGATION_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'delete_edit',
                        token: token,
                        username: username,
                        timestamp: new Date().toISOString()
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    if (errorData.message && (errorData.message.includes('token') || errorData.message.includes('unauthorized'))) {
                        clearToken();
                        requireAuth();
                        return;
                    }
                    throw new Error('ÿÆÿ∑ÿß ÿØÿ± ÿßÿ±ÿ™ÿ®ÿßÿ∑ ÿ®ÿß ÿ≥ÿ±Ÿàÿ±');
                }
                
                const data = await response.json();
                const nextpage = data.nextpage || data.nextPage || '';
                
                if (nextpage === 'admin/delete_edit') {
                    adminDashboard.classList.remove('show');
                    deleteEditPage.classList.add('show');
                    deleteEditPage.style.display = 'block';
                    backBtn.style.display = 'flex';
                } else if (nextpage === 'login') {
                    clearToken();
                    requireAuth();
                } else if (nextpage === 'Home') {
                    adminDashboard.classList.remove('show');
                    mainHeader.classList.remove('header-admin-mode');
                    mainContentArea.style.display = 'block';
                    document.querySelector('.search-bar').style.display = 'flex';
                }
            } catch (error) {
                console.error('Delete/Edit error:', error);
                alert('ÿÆÿ∑ÿß ÿØÿ± ÿßÿ±ÿ™ÿ®ÿßÿ∑ ÿ®ÿß ÿ≥ÿ±Ÿàÿ±');
            }
        });

        addBtn.addEventListener('click', async function() {
            // ÿßÿ∂ÿßŸÅŸá - trigger webhook and check response
            if (!requireAuth()) return;
            
            try {
                const token = getToken();
                const username = getUsername();
                
                if (!token) {
                    alert('ŸÑÿ∑ŸÅÿßŸã ÿßÿ®ÿ™ÿØÿß Ÿàÿßÿ±ÿØ ÿ¥Ÿà€åÿØ');
                    return;
                }
                
                const response = await fetch(PAGE_NAVIGATION_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'add',
                        token: token,
                        username: username,
                        timestamp: new Date().toISOString()
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    if (errorData.message && (errorData.message.includes('token') || errorData.message.includes('unauthorized'))) {
                        clearToken();
                        requireAuth();
                        return;
                    }
                    throw new Error('ÿÆÿ∑ÿß ÿØÿ± ÿßÿ±ÿ™ÿ®ÿßÿ∑ ÿ®ÿß ÿ≥ÿ±Ÿàÿ±');
                }
                
                const data = await response.json();
                const nextpage = data.nextpage || data.nextPage || '';
                
                if (nextpage === 'admin/add') {
                    adminDashboard.classList.remove('show');
                    addPage.classList.add('show');
                    addPage.style.display = 'block';
                    backBtn.style.display = 'flex';
                } else if (nextpage === 'login') {
                    clearToken();
                    requireAuth();
                } else if (nextpage === 'Home') {
                    adminDashboard.classList.remove('show');
                    mainHeader.classList.remove('header-admin-mode');
                    mainContentArea.style.display = 'block';
                    document.querySelector('.search-bar').style.display = 'flex';
                }
            } catch (error) {
                console.error('Add error:', error);
                alert('ÿÆÿ∑ÿß ÿØÿ± ÿßÿ±ÿ™ÿ®ÿßÿ∑ ÿ®ÿß ÿ≥ÿ±Ÿàÿ±');
            }
        });

        // Support form submission
        supportForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!requireAuth()) return;
            
            const text = document.getElementById('supportText').value.trim();
            const number = document.getElementById('supportNumber').value.trim();

            if (!text || !number) {
                alert('ŸÑÿ∑ŸÅÿßŸã ÿ™ŸÖÿßŸÖ ŸÅ€åŸÑÿØŸáÿß ÿ±ÿß Ÿæÿ± ⁄©ŸÜ€åÿØ');
                return;
            }

            supportSubmitBtn.disabled = true;
            supportSubmitBtn.textContent = 'ÿØÿ± ÿ≠ÿßŸÑ ÿßÿ±ÿ≥ÿßŸÑ...';

            try {
                const token = getToken();
                const username = getUsername();
                
                if (!token) {
                    alert('ŸÑÿ∑ŸÅÿßŸã ÿßÿ®ÿ™ÿØÿß Ÿàÿßÿ±ÿØ ÿ¥Ÿà€åÿØ');
                    supportSubmitBtn.disabled = false;
                    supportSubmitBtn.textContent = 'ÿßÿ±ÿ≥ÿßŸÑ';
                    return;
                }
                
                const response = await fetch(ADMIN_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'support',
                        token: token,
                        username: username,
                        text: text,
                        number: number,
                        timestamp: new Date().toISOString()
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    if (errorData.message && (errorData.message.includes('token') || errorData.message.includes('unauthorized'))) {
                        clearToken();
                        requireAuth();
                        return;
                    }
                    throw new Error('ÿÆÿ∑ÿß ÿØÿ± ÿßÿ±ÿ≥ÿßŸÑ Ÿæ€åÿßŸÖ');
                }

                const data = await response.json();
                if (response.ok) {
                    alert('Ÿæ€åÿßŸÖ ÿ¥ŸÖÿß ÿ®ÿß ŸÖŸàŸÅŸÇ€åÿ™ ÿßÿ±ÿ≥ÿßŸÑ ÿ¥ÿØ');
                    supportForm.reset();
                    supportModal.classList.remove('show');
                }
            } catch (error) {
                console.error('Support form error:', error);
                alert('ÿÆÿ∑ÿß ÿØÿ± ÿßÿ±ÿ≥ÿßŸÑ Ÿæ€åÿßŸÖ. ŸÑÿ∑ŸÅÿßŸã ÿØŸàÿ®ÿßÿ±Ÿá ÿ™ŸÑÿßÿ¥ ⁄©ŸÜ€åÿØ.');
            } finally {
                supportSubmitBtn.disabled = false;
                supportSubmitBtn.textContent = 'ÿßÿ±ÿ≥ÿßŸÑ';
            }
        });

        // Close support modal
        closeSupportModalBtn.addEventListener('click', function() {
            supportModal.classList.remove('show');
        });

        supportModal.addEventListener('click', function(e) {
            if (e.target === supportModal) {
                supportModal.classList.remove('show');
            }
        });

        // Close colored pages
        closeGreenPageBtn.addEventListener('click', function() {
            greenPage.classList.remove('show');
        });

        closeRedPageBtn.addEventListener('click', function() {
            redPage.classList.remove('show');
        });

        // Image upload preview functionality
        if (imagePreview && imageInput) {
            // Click on preview area to trigger file input
            imagePreview.addEventListener('click', function() {
                imageInput.click();
            });

            // Handle file selection
            imageInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        imagePreview.innerHTML = `<img src="${e.target.result}" alt="Preview" />`;
                    };
                    reader.readAsDataURL(file);
                } else {
                    imagePreview.innerHTML = `
                        <div class="image-upload-placeholder">
                            <span class="upload-icon">üìé</span>
                            <span class="upload-text">ÿ®ÿßÿ±⁄Øÿ∞ÿßÿ±€å ÿ™ÿµŸà€åÿ±</span>
                        </div>
                    `;
                }
            });
        }

        // Add form submission
        if (addForm) {
            addForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                if (!requireAuth()) return;
                
                const goldCode = document.getElementById('goldCode').value.trim();
                const productDescription = document.getElementById('productDescription').value.trim();
                const imageFile = imageInput ? imageInput.files[0] : null;

                if (!goldCode || !productDescription) {
                    alert('ŸÑÿ∑ŸÅÿßŸã ⁄©ÿØ ÿ∑ŸÑÿß Ÿà ÿ™Ÿàÿ∂€åÿ≠ÿßÿ™ ŸÖÿ≠ÿµŸàŸÑ ÿ±ÿß Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ');
                    return;
                }

                addSubmitBtn.disabled = true;
                addSubmitBtn.innerHTML = '<span class="send-icon">‚è≥</span>';

                try {
                    const token = getToken();
                    const username = getUsername();
                    
                    if (!token) {
                        alert('ŸÑÿ∑ŸÅÿßŸã ÿßÿ®ÿ™ÿØÿß Ÿàÿßÿ±ÿØ ÿ¥Ÿà€åÿØ');
                        addSubmitBtn.disabled = false;
                        addSubmitBtn.innerHTML = '<span class="send-icon">‚Üë</span>';
                        return;
                    }
                    
                    // Convert image to base64 if present
                    let imageBase64 = null;
                    if (imageFile) {
                        imageBase64 = await new Promise((resolve, reject) => {
                            const reader = new FileReader();
                            reader.onload = () => resolve(reader.result);
                            reader.onerror = reject;
                            reader.readAsDataURL(imageFile);
                        });
                    }

                    const response = await fetch(ADMIN_WEBHOOK_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            action: 'add_product',
                            token: token,
                            username: username,
                            goldCode: goldCode,
                            productDescription: productDescription,
                            image: imageBase64,
                            timestamp: new Date().toISOString()
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        if (errorData.message && (errorData.message.includes('token') || errorData.message.includes('unauthorized'))) {
                            clearToken();
                            requireAuth();
                            return;
                        }
                        throw new Error(errorData.message || 'ÿÆÿ∑ÿß ÿØÿ± ÿßÿ±ÿ≥ÿßŸÑ ÿßÿ∑ŸÑÿßÿπÿßÿ™');
                    }

                    const data = await response.json();
                    if (response.ok) {
                        alert('ŸÖÿ≠ÿµŸàŸÑ ÿ®ÿß ŸÖŸàŸÅŸÇ€åÿ™ ÿßÿ∂ÿßŸÅŸá ÿ¥ÿØ');
                        addForm.reset();
                        if (imagePreview) {
                            imagePreview.innerHTML = `
                                <div class="image-upload-placeholder">
                                    <span class="upload-icon">üìé</span>
                                    <span class="upload-text">ÿ®ÿßÿ±⁄Øÿ∞ÿßÿ±€å ÿ™ÿµŸà€åÿ±</span>
                                </div>
                            `;
                        }
                        
                        // Check for nextpage in response
                        const nextpage = data.nextpage || data.nextPage || '';
                        
                        if (nextpage === 'admin/add') {
                            // Stay on add page - don't navigate away
                            // Form is already reset above, user can add more items
                        } else if (nextpage === 'login') {
                            clearToken();
                            requireAuth();
                            addPage.classList.remove('show');
                            addPage.style.display = 'none';
                        } else if (nextpage === 'Home') {
                            addPage.classList.remove('show');
                            addPage.style.display = 'none';
                            adminDashboard.classList.remove('show');
                            mainHeader.classList.remove('header-admin-mode');
                            mainContentArea.style.display = 'block';
                            document.querySelector('.search-bar').style.display = 'flex';
                        } else {
                            // Default: go back to admin dashboard
                            addPage.classList.remove('show');
                            addPage.style.display = 'none';
                            adminDashboard.classList.add('show');
                        }
                    }
                } catch (error) {
                    console.error('Add form error:', error);
                    alert('ÿÆÿ∑ÿß ÿØÿ± ÿßÿ±ÿ≥ÿßŸÑ ÿßÿ∑ŸÑÿßÿπÿßÿ™. ŸÑÿ∑ŸÅÿßŸã ÿØŸàÿ®ÿßÿ±Ÿá ÿ™ŸÑÿßÿ¥ ⁄©ŸÜ€åÿØ.');
                } finally {
                    addSubmitBtn.disabled = false;
                    addSubmitBtn.innerHTML = '<span class="send-icon">‚Üë</span>';
                }
            });
        }

        // Add page back button handler
        if (addPageBackBtn) {
            addPageBackBtn.addEventListener('click', function() {
                addPage.classList.remove('show');
                addPage.style.display = 'none';
                adminDashboard.classList.add('show');
                backBtn.style.display = 'none';
            });
        }

        // Delete/Edit page back button handler
        if (deleteEditPageBackBtn) {
            deleteEditPageBackBtn.addEventListener('click', function() {
                deleteEditPage.classList.remove('show');
                deleteEditPage.style.display = 'none';
                adminDashboard.classList.add('show');
                backBtn.style.display = 'none';
            });
        }

        // Delete/Edit form submission
        if (deleteEditForm) {
            deleteEditForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                if (!requireAuth()) return;
                
                const inputValue = deleteEditInput.value.trim();

                if (!inputValue) {
                    alert('ŸÑÿ∑ŸÅÿßŸã ⁄©ÿØ ÿ∑ŸÑÿß €åÿß ÿ™Ÿàÿ∂€åÿ≠ÿßÿ™ ŸÖÿ≠ÿµŸàŸÑ ÿ±ÿß Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ');
                    return;
                }

                deleteEditSubmitBtn.disabled = true;
                deleteEditSubmitBtn.innerHTML = '<span class="send-icon">‚è≥</span>';

                try {
                    const token = getToken();
                    const username = getUsername();
                    
                    if (!token) {
                        alert('ŸÑÿ∑ŸÅÿßŸã ÿßÿ®ÿ™ÿØÿß Ÿàÿßÿ±ÿØ ÿ¥Ÿà€åÿØ');
                        deleteEditSubmitBtn.disabled = false;
                        deleteEditSubmitBtn.innerHTML = '<span class="send-icon">‚Üë</span>';
                        return;
                    }
                    
                    const response = await fetch(ADMIN_WEBHOOK_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            action: 'delete_edit_search',
                            token: token,
                            username: username,
                            searchQuery: inputValue,
                            timestamp: new Date().toISOString()
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        if (errorData.message && (errorData.message.includes('token') || errorData.message.includes('unauthorized'))) {
                            clearToken();
                            requireAuth();
                            return;
                        }
                        throw new Error(errorData.message || 'ÿÆÿ∑ÿß ÿØÿ± ÿßÿ±ÿ≥ÿßŸÑ ÿßÿ∑ŸÑÿßÿπÿßÿ™');
                    }

                    const data = await response.json();
                    
                    // Handle response based on backend response
                    // User will explain what to show in next comment
                    console.log('Delete/Edit response:', data);
                    
                } catch (error) {
                    console.error('Delete/Edit form error:', error);
                    alert('ÿÆÿ∑ÿß ÿØÿ± ÿßÿ±ÿ≥ÿßŸÑ ÿßÿ∑ŸÑÿßÿπÿßÿ™. ŸÑÿ∑ŸÅÿßŸã ÿØŸàÿ®ÿßÿ±Ÿá ÿ™ŸÑÿßÿ¥ ⁄©ŸÜ€åÿØ.');
                } finally {
                    deleteEditSubmitBtn.disabled = false;
                    deleteEditSubmitBtn.innerHTML = '<span class="send-icon">‚Üë</span>';
                }
            });
        }
    </script>
</body>
</html>
